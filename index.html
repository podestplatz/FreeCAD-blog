<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Blog to the development of the BCF FreeCAD plugin.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FreeCAD BCF-Plugin development blog | FreeCAD BCF-Plugin development blog</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://podestplatz.github.io/FreeCAD-blog/">
<link rel="icon" href="favicon-16.ico" sizes="16x16">
<link rel="icon" href="favicon-32.ico" sizes="32x32">
<link rel="icon" href="favicon-256.ico" sizes="256x256">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/dev-logs/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<div class="blog-masthead">
    <div class="container">
<!-- This keeps the margins nice -->
        <nav class="blog-nav" role="navigation"><a href="#" class="blog-nav-item">Home</a>
            <a href="archive.html" class="blog-nav-item">Archive</a>
            <a href="categories/index.html" class="blog-nav-item">Tags</a>
            <a href="rss.xml" class="blog-nav-item">RSS feed</a>

            

                
                
                    
                
            
        </nav>
</div>
<!-- /.container -->
</div>
<!-- End of Menubar -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <div class="blog-header">
            <h1 class="blog-title">
                <a href="https://podestplatz.github.io/FreeCAD-blog/">

                    <span id="blog-title">FreeCAD BCF-Plugin development blog</span>
                </a>
            </h1>
            <p class="lead blog-description">Blog to the development of the BCF FreeCAD plugin.</p>
            
        </div>
        <!--Body content-->
        <div class="row">
            <div class="col-sm-8 blog-main">
                

<div class="postindex">
    <article class="blog-post h-entry post-text"><header><h2 class="p-name entry-title blog-post-title"><a href="posts/dev-logs/" class="u-url">Dev Logs</a></h2>
        <div class="metadata blog-post-meta">
            <p class="byline author vcard"><span class="byline-name fn">Patrick Podest</span></p>
            <p class="dateline"><a href="posts/dev-logs/" rel="bookmark"><time class="published dt-published" datetime="2019-06-22T08:00:00+00:00" title="2019-06-22 08:00">2019-06-22 08:00</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>This is a daily updated log of the work I do on the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/">BCF-plugin</a> for FreeCAD</p>
<p><strong>July 26th:</strong> More development work today than the last couple of days.
First of all I finished the clipping plane stuff. Clipping planes can now be
created, <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/0d20165e2f806a637ecc6cafd216c574cf493c20">commit 0d20165</a> is the one to go if you are interested in how it is
realized.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/6d4727d1e444f2532c9376a830577fbfad214997">commit 6d4727d</a> adds stuff, but that was not done today. I noticed that I
still had a git-stash lying around with useful changes. For one the colour
regular expression gets fixed in this commit, some informative prints are added
concerning the colouring of components and viewpoints will be coloured in
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/d28b044173c13fa82e8d35b0ce59e45de9456de6/bcfplugin/programmaticInterface.py#L439">pI.activateViewpoint()</a>.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/0d20165e2f806a637ecc6cafd216c574cf493c20">commit d28b044</a> adds a nifty little feature linking viewpoints and comments.
As you may know, a comment can reference a viewpoint, as you also may know the
plugin sports a list showing all available viewpoints. Now, when the user
selects a comment that references a viewpoint, the viewpoints list will be
automatically shown and the referenced viewpoint is selected.</p>
<p>The main part of my work today, however, is still offline and concerns a
separate dialog window that shows the data available on a topic, and also makes
it availabe (the parts that I consider mutable) for changes by the user. But it
still is not finished as I have to add a Delegate. The Delegate is needed
because the user might change the <cite>dueDate</cite> which has some restrictions on the
set of possible values that might be entered. This will be done with a delegate
in the end.</p>
<p><strong>July 25th:</strong> Today I checked that my algorithm for drawing lines worked, and
thus have written a simple test case (<cite>viewController-test.py</cite>) that draws the
lines, specified in a prepared BCF file. These three lines are 5000mm long and
lie directly on each coordinate axis. This was done in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/1910afdc0511b8540eb6a0e84afcb0d93bdd3cde">commit 1910afd</a>.</p>
<p>Then I have written a nicer introduction to the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/wiki">wiki</a> pages, including a short
BCF primer, to get anyone started on this topic.</p>
<p>The remaining time of the day I investigated how clipping planes can be drawn in
FreeCAD. Therefore I first looked into the source code which led me to the
documentation of the coin library. In addition to the knowledge of how to use it
I also wanted to know more about the mathematics behind it.
At the end of the workday I felt confident to start working on the function
<cite>createClippingPlane()</cite> in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature/gui/bcfplugin/frontend/viewController.py">viewController.py</a>, which is for one not finished
and for the other not pushed to github. That I will do tomorrow.</p>
<p><strong>July 24th:</strong> Right now, during closing FreeCAD for the day, I thought "Man I
like FreeCAD more and more!"</p>
<p>Now, after this insight on to the dev-log for this day. I finished my update of
the wiki pages, and the README.md file. It all is still located on the
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature/gui">feature/gui</a> branch. These two aspects of the wiki update are done in two
separate commits. <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/ab78a0f596792eebe45d0eabebfbc492fecad1b8">commit ab78a0f</a> adds a new section to the README.md file,
dedicated to the Qt user interface. <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/c8705dd540238d978f844b43c1688795199a5a16">commit c8705dd</a> then adds a <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/wiki/GUI-Tutorial">new page</a> to
the wiki. It gives an introduction to the graphical user interface of the
plugin, and explains all aspects of it (that were implemented till today).</p>
<p>After this I made another attempt to applying viewpoints, because I didn't
believe that my implementation was correct. Two major insights were the result
of this effort:</p>
<ol class="arabic simple">
<li>The underlying unit of FreeCAD (on my system at least) is millimeter, not
meter.</li>
<li>The field of view is to be set in radians and not in full degrees.</li>
</ol>
<p>These two insights were then molded into code in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/47c115190107f95d4b7724b8309ad75db6ef5c64">commit 47c1151</a>.</p>
<p>Since a BCF file can also specify lines to be drawn, as well as whole planes.
The first step would be to just draw lines and so I did. This resulted in
additional code (two new functions and some new state variables) in
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature/gui/bcfplugin/frontend/viewController.py">viewController.py</a>. The corresponding commit is <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/64d381c22179c956baa465fa6e4b06eb526a5474">commit 64d381c</a>.
The new functions are</p>
<ul class="simple">
<li>
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/64d381c22179c956baa465fa6e4b06eb526a5474/bcfplugin/frontend/viewController.py#L208">drawLine()</a>: draws one single line using the draft workbench and returns
it.</li>
<li>
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/64d381c22179c956baa465fa6e4b06eb526a5474/bcfplugin/frontend/viewController.py#L240">createLines()</a>: takes on the <cite>lines</cite> object from the viewpoint inside the
data model and tries to draw all lines. If one cannot be drawn it is simply
skipped.</li>
</ul>
<p><strong>July 23rd:</strong> Today I have updated the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/wiki">wiki</a> page of the project, as well as
written a small wrap up of the stuff that was added to the plugin since the last
evaluation period.</p>
<p><strong>July 22nd:</strong> I fixed some issues I had with the deepcopy
implementation. Thereby I focused on the modification of a comment. Here it was
the case that for one the states of objects were not copied, which prevented the
writer module from updating anything. This part got fixed in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/f73b8b19c579b202a69cdedc18ae8735140f00c2">commit f73b8b1</a>.
Then <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/975ba91ef515ddea828d285150264bf0c16e600e">commit 975ba91</a> fixes the issue of not properly updating the
<cite>ModificationAuthor</cite> and <cite>ModificationDate</cite> fields inside a comment.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/042859c8d533df9d7d4ef1f640d6ed3c1bbd1200">commit 042859c</a> merges my feature development branch
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature/gui_switch_to_relative_sizes">feature/gui_switch_to_relative_sizes</a> into the main gui feature branch. The
relative sizes are now calculated using the <a class="reference external" href="https://doc.qt.io/qt-5/qscreen.html">QScreen</a> object of the screen the
Qt application is running on and with it calculating the pixels per millimeter.
That value is used to convert the distances (given in millimeters) into pixels.</p>
<p><strong>July 21st:</strong> Also no work done today.</p>
<p><strong>July 20th:</strong> Did not work today.</p>
<p><strong>July 19th:</strong> Today I spent my time just on the deepcopy topic. As it turnes
out it is not as easy as I thought to create correct deep copies of objects in
my data model.</p>
<p>Things to consider for creating a deep copy:</p>
<ul class="simple">
<li>The unique <cite>id</cite>, created in the constructor of every class in the data model
has to be copied to stay exactly the same. Otherwise the search algorithm
implemented in <cite>project.py</cite> does not work anymore. The plugin has to be able
to search for an object in the original data model and in the copied one by
the same unique <cite>id</cite>.</li>
<li>The state of an object has to be copied also, otherwise the <cite>writer</cite> module
won't make an update or in the worst case, delete an object which rather
should be modified.</li>
</ul>
<p>But a few words on how I am implementing the custom deep copy:</p>
<p>Since it is not best to copy the whole project, when just copying a single
comment, somehow the hierarchy of an object (<cite>Hierarchy.containingObject</cite>) has
to be ignored. But if the member <cite>Hierarchy.containingObject</cite> does not get set
in any copy function, then the writer module does not work anymore.
Reason being that for every new update a deepcopy of the project and the
modified element is made. During an update however the hierarchy of the modified
element is required, which cannot be created anymore, since
<cite>Hierarchy.containingObject</cite> did not get set in the copy process.
To solve this issue, I decided to copy everything downwards the Hierarchy. If
for example a copy of a <cite>Markup</cite> object shall be created then everything
referenced by that markup object is also copied, <em>but</em> the <cite>containingObject</cite> of
this <cite>Markup</cite> object is not copied. The actual way that this can be accomplished
is really simple: each <cite>__deepcopy__()</cite> function has to set the
<cite>containingObject</cite> member of its copied members after the copy was being
created. To illustrate it consider the following code:</p>
<pre class="code python"><a name="rest_code_d17e1d3f72ad4e3eb6a9004e3f2ae623-1"></a><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<a name="rest_code_d17e1d3f72ad4e3eb6a9004e3f2ae623-2"></a>
<a name="rest_code_d17e1d3f72ad4e3eb6a9004e3f2ae623-3"></a><span class="k">class</span> <span class="nc">Markup</span><span class="p">(</span><span class="n">Hierarchy</span><span class="p">):</span>
<a name="rest_code_d17e1d3f72ad4e3eb6a9004e3f2ae623-4"></a>
<a name="rest_code_d17e1d3f72ad4e3eb6a9004e3f2ae623-5"></a>  <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
<a name="rest_code_d17e1d3f72ad4e3eb6a9004e3f2ae623-6"></a>    <span class="o">...</span>
<a name="rest_code_d17e1d3f72ad4e3eb6a9004e3f2ae623-7"></a>    <span class="n">cpyid</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">memo</span><span class="p">)</span>
<a name="rest_code_d17e1d3f72ad4e3eb6a9004e3f2ae623-8"></a>    <span class="n">cpyComment</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">memo</span><span class="p">)</span>
<a name="rest_code_d17e1d3f72ad4e3eb6a9004e3f2ae623-9"></a>    <span class="n">cpy</span> <span class="o">=</span> <span class="n">Markup</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<a name="rest_code_d17e1d3f72ad4e3eb6a9004e3f2ae623-10"></a>    <span class="n">cpy</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">cpyComment</span>
<a name="rest_code_d17e1d3f72ad4e3eb6a9004e3f2ae623-11"></a>    <span class="n">cpy</span><span class="o">.</span><span class="n">comment</span><span class="o">.</span><span class="n">containingObject</span> <span class="o">=</span> <span class="n">cpy</span>
<a name="rest_code_d17e1d3f72ad4e3eb6a9004e3f2ae623-12"></a>    <span class="n">cpy</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">cpyid</span>
<a name="rest_code_d17e1d3f72ad4e3eb6a9004e3f2ae623-13"></a>    <span class="o">...</span>
</pre>
<p>Here you see for one that <cite>containingObject</cite> is set, and also that the <cite>id</cite>
member is copied and overwritten in the new object of <cite>Markup</cite>.
This way it is guaranteed that a copy from <cite>Markup</cite> is only copying everything
below it (i.e.: every member of markup), but the <cite>containingObject</cite> of <cite>Markup</cite>
itself is left untouched.</p>
<p>Since this deepcopy topic is still really buggy, I don't have any commits to
show, all work is still done locally.</p>
<p><strong>July 18th:</strong> Not much dev work done today, although I have written quite a
number of lines. Aside from switching to relative distances in the UI, I also
make an effort to increase performance of the plugin a bit.
Currently it is the case that for every inquiry of the programmatic interface,
if information shall be retrieved (like a list of all comments), then in the
process of making a deep copy of every comment, inevitably a deep copy of the
whole project is made. Why? Because of the <cite>Hierarchy</cite> interface, which provides
each implementing class with a reference to the class that holds the reference
to it. That means, during a deep copy operation, python will stumble on the
reference to the containing object and make a copy of it too. But the containing
object again has a reference to its containing object and so on. So in effect,
if a copy shall be created for the modification date, the complete project with
all its topics is copied too, which is a huge overhead!
To solve this performance problem I implemented the special function
<cite>__deepcopy__()</cite> into every class that inherits from <cite>Hierarchy</cite>. But the test
cases don't work anylonger with these changes. That is were I left off today.</p>
<p>Before implementing <cite>__deepcopy__()</cite> I made an effort to understand rotations
in the three dimensional space, using <a class="reference external" href="https://en.wikipedia.org/wiki/Euler_angles">Euler-Angles (yaw-pitch-roll)</a>, a
<a class="reference external" href="https://en.wikipedia.org/wiki/Rotation_matrix#In_three_dimensions">rotation matrix</a> and quarternions (which are really cool btw.). Also I looked
into how one can be transformed into the other. And I got stuck at trying to
recreate the example given on the <a class="reference external" href="https://www.freecadweb.org/wiki/File:PlacePyConv10.png">wiki</a> page, unfortunately to no avail.</p>
<p><strong>July 17th:</strong> Now two options are available for exploring the available
viewpoints. The one was already added and is the SnapshotBar. It is still
lacking the functionality to activate a viewpoint when a certain click event
happens. The second option is a viewpoints list. It lists all the viewpoints
available in a selected topic. If this viewpoint also references a snapshot file
then an icon of this snapshot file is shown beside the viewpoint filename. The
icon can be changed in size by calling <cite>ViewpointsListModel.setIconSize()</cite>, per
default it is set to be 10 millimeters in width and height. Sizes are expected
to be given in millimeters. The commit adding the Viewpoints list is <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/18c5b9e0253930d0bd254a78f685da9bd2ade7cd">commit
18c5b9e</a>.</p>
<p>The next commit, <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/24bd9295a93c57c90f8bf26cf10f739b1721422a">commit 24bd929</a>, somehow is separate from the above one, but
is also required by it. It adds the function <cite>util.getCurrentQScreen()</cite> to
<cite>util.py</cite>. This function returns the <a class="reference external" href="https://doc.qt.io/qt-5/qscreen.html">QScreen</a> associated with the screen the
current Qt application is shown on. This serves the purpose of retrieving the
correct DPI setting to be able to convert the millimeter sizes to pixels.</p>
<p>Then the bug fix, which cost me some time (3.5 hours to be exact), of <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/fe7d19597cebf8218ef48cbbd75e47a815c0c38b">commit
fe7d195</a> fixes the issue where the size of a comment list element is not
properly resized, as its painted area increases or decreases in height.</p>
<p>The remaining time today, 3 hours, I spent with applying the viewpoint settings
to the active view in FreeCAD. As many of you will know, Quarternions are a
great tool for representing rotations in the three dimensional space. When
applying the camera settings, inevitably a rotation has to take place, which are
done in FreeCAD using ... exactly! Quarternions. Initially
I thought that I didn't have to be concerned with Quarternions as some library
functions exist that handle it for me. But during the application of the
viewpoint settings, I noticed that my approach to rotating the camera does
probably not work. So I walked through <a class="reference external" href="https://eater.net/quaternions">this explorative video series</a>, which
is great, to get a better understanding of them and how to operate with them.
I want to better understand the 3D rotations and how FreeCAD does them, to be
able to correctly rotate the camera.</p>
<p><strong>July 16th:</strong> I finished the SnapshotBar I was talking about yesterday. Till
now it just shows a maximum of three snapshots. The way I implemented it is a
bit hacky because I didn't find a suitable way to just display labels, that
contain a pixmap, inside of a list view. So I am just using the
<cite>Qt.DecorationRole</cite> to display the icons of the list elements, and nothing else.
To check it out see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/0938ac01ac953146aa12d56c2b5578c7660101e7">commit 0938ac0</a>.</p>
<p>In the second "major" commit today I implemented word-wrapping for the comment
text. For this I integrated the <cite>width</cite> of the widget into the associated
delegate class (<cite>CommentDelegate</cite>), I couldn't find any other way to access,
reliably, the current width of the widget, which serves as base for the wrapping
calculation. This is still in development and is buggy. For example: the list
items do not properly resize when the width of the window decreases and the
comments are wrapped. But on the upside: the bug with the wrongly placed
<cite>Delete</cite> button was fixed during developing the comment wrapping. All of this is
contained in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/d20a3a9bdcdfb08a3ee352c2e5cd946b6de6307e">commit d20a3a9</a>.</p>
<p><strong>July 15th:</strong> Today I mostly worked offline, and only published one commit.
The <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/3642e4794e052ab43a1fa44460a69ee7301d14ad">commit 3642e47</a> adds the feature that the color of a comment is blue if it
references a viewpoint. Otherwise it will be drawn in black.</p>
<p>Most of the work today, I did on the "SnapshotBar", as I call it. This shall be
a collection of classes (comprised of model classes and view classes) that
display small versions of the snapshots contained in the project. It shall
present three snapshots in a row, and if more snapshots are present in the topic
then a vertical scrollbar is available.</p>
<p>However, I am currently still struggling with getting the images to show using a
<cite>QListView</cite>. I tried returning a <cite>QLabel</cite> from <cite>SnapshotModel.data()</cite> into which
already the desired picture is loaded, but it did not work that way. Hopefully I
get it done by tomorrow.</p>
<p><strong>July 14th:</strong> Today also I did not work on the plugin.</p>
<p><strong>July 13th:</strong> I did not work on the plugin today.</p>
<p><strong>July 12th:</strong> The usability of the plugin was greatly improved today!</p>
<p>Most of the time today I was working on the feature to delete comments from the
UI. The way I want to do it is with a button that appears on the right side of
the comment when the mouse hovers the comment. It still is not perfect, but
already usable. The accompanying commit is <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/051622cea6fe0f1091a8093f283e3a120506d031">commit 051622c</a>.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/051622cea6fe0f1091a8093f283e3a120506d031">commit 051622c</a> contains one particular line that I changed. It was a
<a class="reference external" href="https://en.wikipedia.org/wiki/Heisenbug#Related_terms">higgs-bugson</a>, at least that is the most fitting classification. The behaviour
expressed was that comments were deleted by pressing the button... in the file
but not in the model. Strangely my testbench for deleting objects, especially
comments, worked. After long debugging I noticed that my policy of not exposing
the real working data to the UI came back to haunt me. My <cite>pI.deleteObject</cite>
function looked like this:</p>
<pre class="code python"><a name="rest_code_446622680dac49ffaab419cad0898910-1"></a><span class="k">def</span> <span class="nf">deleteObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_446622680dac49ffaab419cad0898910-2"></a>  <span class="k">global</span> <span class="n">curProject</span>
<a name="rest_code_446622680dac49ffaab419cad0898910-3"></a>  <span class="n">realObject</span> <span class="o">=</span> <span class="n">searchObject</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
<a name="rest_code_446622680dac49ffaab419cad0898910-4"></a>  <span class="n">realObject</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">DELETED</span>
<a name="rest_code_446622680dac49ffaab419cad0898910-5"></a>  <span class="n">writer</span><span class="o">.</span><span class="n">addProjectUpdate</span><span class="p">(</span><span class="n">curProject</span><span class="p">,</span> <span class="n">realObject</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
<a name="rest_code_446622680dac49ffaab419cad0898910-6"></a>  <span class="n">writer</span><span class="o">.</span><span class="n">processProjectUpdates</span><span class="p">()</span>
<a name="rest_code_446622680dac49ffaab419cad0898910-7"></a>  <span class="n">curProject</span><span class="o">.</span><span class="n">deleteObject</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
</pre>
<p>The last line here was the culprit. It is responsible for deleting the object
from the data model after it was deleted from the file. Here I used the wrong
reference, namely the one of the copy of the real object.</p>
<p>Then <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/b15667183dacf3b6715759e353c55375d9b2f71d">commit b156671</a> adds a save button, that opes a "save-file-dialog" and
lets the user save the current state of the working directory.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/253e3a956e62926d208b863b88f282a2a7c4772d">commit 253e3a9</a> fixes the bug where the comment list was not reset when the
topics were switched.</p>
<p>There are still some commits I pushed today, but these were the most notable
ones.</p>
<p><strong>July 11th:</strong> Qt is easy to start with, but hard to get right.</p>
<p>I today was mostly on bug hunts, why some stuff was not showing or behaving as I
wanted it to. Like for example the horizontal scrolling in the comment view. It
somehow did not draw the correct contents when scrolled horizontally.
Furthermore was the horizontal scrollbar kind of inconsistent. It did not always
show up. Both these issues are fixed in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/f82e40a9f2f5e8fbcf6cf7cbf3c9bb2e96232654">commit f82e40a</a>. The first bug was
resolved by correctly setting the drawing position according to
<a class="reference external" href="https://doc.qt.io/qt-5/qstyleoptionviewitem.html">QStyleOptionViewItem options</a>. The second bug was caused by an incorrect
calculation of the length of an item in the list in
<cite>plugin_delegate.sizeHint()</cite>.</p>
<p>What is particular noteworthy is that the plugin now can also be opened in the
taskpanel of FreeCAD. This functionality was added in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/b2ebca5d15d628da4c150dc5a9db723688f49dc3">commit b2ebca5</a> and can
be used (will be streamlined in the future) by executing the following two
commands inside of the FreeCAD python console.</p>
<pre class="code python"><a name="rest_code_416793ddd61140adb0e8ad4e327720ea-1"></a><span class="kn">import</span> <span class="nn">bcfplugin.gui.plugin_panel</span> <span class="kn">as</span> <span class="nn">panel</span>
<a name="rest_code_416793ddd61140adb0e8ad4e327720ea-2"></a><span class="n">panel</span><span class="o">.</span><span class="n">launch_ui</span><span class="p">()</span>
</pre>
<p>I also had an issue with FreeCAD itself and its behavior of swallowing
exceptions that are thrown inside of my plugin. It is really nice that an
exception inside an outside plugin does not crash FreeCAD, and that is how it is
supposed to be. But an error message, that an exception was thrown inside the
plugin, would sometimes greatly improve debugging. The bug that made me aware of
this fact was that in the comment view comments were shown in FreeCAD on my PC
running ArchLinux but were not shown on the virtual machine running Ubuntu
18.04. This behavior was rooted in a missing import of <cite>QtCore.Qt</cite> in
<cite>plugin_delegate.py</cite> and <cite>plugin_mode.py</cite>. Strangely, though, it worked on my PC
when it actually shouldn't. Anyways, the fix is contained in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/9cfb5fa4bae30a43c77bea363c0caf54d9f78f8b">commit 9cfb5fa</a>.</p>
<p>Finally, not only bugs were fixed today, also something new was added to the UI.
Below the comment list a <cite>QLineEdit</cite> is now accessible for adding new comments.
A new comment can be submitted by hitting enter after finished. Not only the
comment has to be entered into this field, however, the author's E-Mail has to
be appended to the comment, separating the two with ' -- '. If an invalid
comment is about to be inserted a tooltip will be shown with a guide to how the
text shall be structured in order for it to be added. This functionality was
added in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/47eaded6a02b76ebc162d7380cd4ae908139facd">commit 47eaded</a>.</p>
<p><strong>July 10th:</strong> My work today boils down to this:</p>
<ul class="simple">
<li>The comment list is finished, apart from a small bug when scrolling
horizontally</li>
<li>The programmaticInterface got a new function to apply visibility settings of a
viewpoint to the objects in the view.</li>
</ul>
<p>So now the more detailed version:</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/fc93660a8108ba98bac265e3689532c3975609fc">commit fc93660</a> fixed two bugs when painting the comment list. Both were
caused by a wrong use of Qt. Previously the position, at which the next comment
should be drawn, was calculated by hand. Now this position is taken from the
argument <cite>options</cite> and its member <cite>rect</cite>.</p>
<pre class="code python"><a name="rest_code_bd98699482c14e66ad3edccdff372fb0-1"></a><span class="k">def</span> <span class="nf">paint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">painter</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<a name="rest_code_bd98699482c14e66ad3edccdff372fb0-2"></a>  <span class="n">topY</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">rect</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>
</pre>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/c93b00461a557db637f52b105b7a3c5c58f952a1">commit c93b004</a> extended <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/bc9664236bf09c60cfd73cde8ea6160f342bf8a1/bcfplugin/programmaticInterface.py#L876">pI.getTopic()</a> with some context awareness. The
general approach is to not expose the data model to the UI layer. Thus for every
retrieve action, requested from <cite>pI</cite>, a deep copy of the actual object is
returned instead of just the reference. <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/bc9664236bf09c60cfd73cde8ea6160f342bf8a1/bcfplugin/programmaticInterface.py#L876">pI.getTopic()</a> however is used inside
and outside <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature/PI_retrieval/bcfplugin/programmaticInterface.py">pI</a>. If it is called from inside of the same module the correct
reference to the actual element shall be returned, if however called from the
outside a copy has to be created and returned to the calling function.
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/bc9664236bf09c60cfd73cde8ea6160f342bf8a1/bcfplugin/programmaticInterface.py#L876">pI.getTopic()</a> is now able to do this, using the <a class="reference external" href="https://docs.python.org/3/library/inspect.html">inspect</a> module.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/a702021d1ae226a256ec9c3341ef028855eb6170">commit a702021</a> integrated the <cite>pI</cite> into the model of the comment list, this
commit therefore made it possible to view actual comments of a bcf file that
gets opened during runtime.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/894de41ef6489fd54efca1000f65dc07e47525b0">commit 894de41</a> introduces the logical next step to the previous commit. It
integrated the comment list into the existing plugin, which previously could
open a project and let the user choose between topics. Now, after the user has
chosen a topic, all comments will be visible and available for modification. The
modification however is constrained with a <a class="reference external" href="https://doc.qt.io/qt-5/qvalidator.html">QValidator</a>.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/9814bb439c2283a5749444b5672ba244b9c78b83">commit 9814bb4</a> adds the functionality of displaying a small pop up window
showing an error to the user.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/bc9664236bf09c60cfd73cde8ea6160f342bf8a1">commit bc96642</a> contains the functionality of applying visibility settings to
the objects in the currently open view.</p>
<p>To checkout the current state of the plugin run the following command from the
directory <cite>./bcfplugin/gui</cite>:</p>
<pre class="code bash"><a name="rest_code_3f0a5b057e624a0588882a72128cab46-1"></a>python plugin_view.py
</pre>
<p><strong>July 9th:</strong> Well I have learned a lot about Qt and how I can customize
existing views with delegates and models. That said the main advancement of
today was the creation of the comments list, how I would like it.</p>
<p>For this development of the comment list I have opened a new feature branch
ontop of <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature/gui">feature/gui</a> called <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature/gui_comment_list">feature/gui_comment_list</a>. <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/5f242fde1987d106c7c52a90a1aeb9543b48be42">commit 5f242fd</a>
adds the first (usable) version of the list. It is based on the <a class="reference external" href="https://doc.qt.io/qt-5/model-view-programming.html">model/view</a>
approach of qt and uses a custom delegate to display the list items. The
development files are located inside of <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/tree/feature/gui_comment_list/bcfplugin/gui/comment-list">./bcfplugin/gui/comment-list/</a>.
To try it just run</p>
<pre class="code bash"><a name="rest_code_24b4e09eb5ee416ab3466cd9f81eec8e-1"></a>python mainwindow.py
</pre>
<p>from inside the before mentioned directory.</p>
<p><strong>July 8th:</strong> Today I started with the first version of the gui. It is
completely contained in <cite>./bcfplugin/gui/plugin_view.py</cite>, but uses
<cite>./bcfplugin/gui/plugin_model.py</cite> to get the data to display. Currently when
<cite>plugin_view.py</cite> is run the user is given the option to open a BCF file, through
an <cite>QFileDialog</cite>. If one was selected the gui removes the "open-file-section"
and replaces it with:</p>
<ol class="arabic simple">
<li>a label displaying the project name</li>
<li>a label just displaying "Topic" and a combobox filled with a list of the
available topics.</li>
</ol>
<p>The commit adding the two files is <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/6887d529f1e3993667338f68402782597d54f63c">commit 6887d52</a>.
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/85d1e8b683612a6b28763ffccfc9689269ba77f4">commit 85d1e8b</a> finishes function <cite>viewController.colourComponents()</cite> that
applies the colour specified in <cite>viewpoint.bcf</cite> to the (also in <cite>viewpoint.bcf</cite>)
specified components.</p>
<p><strong>July 7th:</strong> The weekend I did no work for the plugin</p>
<p><strong>July 6th:</strong> I didn't do any work today.</p>
<p><strong>July 5th:</strong> The first steps to the gui part of the plugin are made!
But first things first. As the programmatic interface is nearly finished in its
basic functionality, I merged the feature branch <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature/PI_retrieval">feature/PI_retrieval</a> into
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/develop">develop</a>. This is done in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/230c1d53f71f8b6c8d12c5066586199c589e16ca">commit 230c1d5</a>.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/0a27fd2307ba64e4fbbd9b58f2a3fc4a3d1ce505">commit 0a27fd2</a> adds the functionality to <cite>writer.py</cite> to add a project file
and create a new bcf file. A new BCF file will at first only exist in the
temporary directory until the function <cite>writer.zipToBcfFile()</cite> is called.</p>
<p>Now onto the gui stuff: I added a new branch <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature/gui">feature/gui</a> on which I will
develop the gui part of the plugin at first. On this branch already some commits
exist but the most notable ones are: <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/53d9dcfd29768eefc02f091480a0c3fa41449af4">commit 53d9dcf</a> which adds an example
model view application that just contains a combobox that lets the user choose
between the available topics in a hardcoded bcf file. This application just
serves as a proof of concept and guiding line over the next days.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/900578927ca57db2f527284d4c13bb8a2b4c48ab">commit 9005790</a> adds two functions that somewhat control the 3D view of
FreeCAD. The first is <cite>vC.getIfcObjects()</cite> (<cite>vC</cite> stands for <cite>viewController</cite>)
which compiles a dictionary of all objects in a document that have a IfcUID.
Here a big thanks to Yorik who provided example code in his <a class="reference external" href="https://forum.freecadweb.org/viewtopic.php?p=318880#p318880">post</a>. The second
function is <cite>vC.selectComponents()</cite> which takes on a list of
<cite>viewpoint.Component</cite> objects and adds every object with a matching IfcUID into
the active selection.</p>
<p><strong>July 4th:</strong> PI (Programmatic Interface) is nearing its finish, at least in the
basic functionality. But onto the commits, and thus the work, I have done today:</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/0d3d924022e042a17692850e03f23e5d1b2f8386">commit 0d3d924</a> is rather small as it just adds a dependency check to
<cite>./bcfplugin/__init__.py</cite>. <a class="reference external" href="https://pypi.org/project/pytz/">pytz</a> is now also checked as dependency.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/66a73a850a9370b3f5e6757dd77f86c2a62abc19">commit 66a73a8</a> introduces the function <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/75946dbfd3b302a29b4e5d1ef21211310cdcebbb/bcfplugin/programmaticInterface.py#L375">pI.addCurrentViewpoint()</a> whose
purpose it is to create a viewpoint object of the current view in FreeCAD.
Currently only the camera position and orientation is read and stored in either
a <cite>PerspectiveCamera</cite> or <cite>OrthogonalCamera</cite> object, depending on the type of the
camera in the FreeCAD view. In the next steps also the highlighted components
shall be detected and read in. But this depends on the ability of discovering
the Ifc guid of a component in FreeCAD.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/36be8ce884799a1803d5d83adfe6676616013c68">commit 36be8ce</a> adds the option to add a complete new topic to the project.
Alongside with a topic object, a new folder gets created inside the BCF file and
a new <cite>markup.bcf</cite> file is created.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/539371fd65ac5ef7d9850ff9116a0a5c7ac043bd">commit 539371f</a> incorporates the modification of Topics and Comments in
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/01fac660932fea2d580cff44421b0a352f893806/bcfplugin/programmaticInterface.py#L750">pI.modifyElement()</a>. These two types have the speciality of containing both
<cite>&lt;ModifiedAuthor&gt;</cite> and <cite>&lt;ModifiedDate&gt;</cite>. If a Topic or Comment object is
updated then these two fields are automatically set/updated with it.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/75946dbfd3b302a29b4e5d1ef21211310cdcebbb">commit 75946db</a> brings some testcases for <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/01fac660932fea2d580cff44421b0a352f893806/bcfplugin/programmaticInterface.py#L750">pI.modifyElement()</a>.</p>
<p><strong>July 3rd:</strong> Today I fully fixed the issue I found in
<cite>writer.getEtElementFromFile()</cite> yesterday. The issue was rooted in the fact that
there may be xml elements that occur in different parts of the hierarchy with
the same name. For example <cite>&lt;ModifiedAuthor&gt;</cite> occurs once as child of <cite>&lt;Topic&gt;</cite>
and once as child of <cite>&lt;Comment&gt;</cite>. In the algorithm for modifying elements first
compiles a list of candidates, out of which the "to-update" element is picked by
matching on either the children of the element, the text of the element or its
attributes. Now the particular issue was that when someone already modified
<cite>&lt;Topic&gt;</cite> and a <cite>&lt;Comment&gt;</cite> then <cite>&lt;ModifiedAuthor&gt;</cite> would have the exact same
text. Due to insufficient selection of the candidates, both <cite>&lt;ModifiedAuthor&gt;</cite>
elements (from Topic and Comment) made it into the list. That lead to
indeterministic selection of the element to update.</p>
<p>This was fixed in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/17c818e1f61d986bc7c1268b9f2448117e4d47b0">commit 17c818e</a>.</p>
<p>Then <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/ebca39f58f3e9d8788ae513ab005a04b0e80de1d">commit ebca39f</a> added <cite>pI.modifyDocumentReference()</cite>, which, however, is
made obsolete in part by <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/01fac660932fea2d580cff44421b0a352f893806">commit 01fac66</a>. In latter one I introduce a more
general modification function <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/01fac660932fea2d580cff44421b0a352f893806/bcfplugin/programmaticInterface.py#L750">pI.modifyElement()</a>. It takes on an object of
the data model, which is assumed to be modified. Next, the old element,
referenced by original element, is deleted from file, the object in the data
model is updated with the member variables and added again to the file.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/91ccac8e9ca32af357967aec16749e9b6a1f5497">commit 91ccac8</a> adds a backup and rollback system to all functions that alter
the state of the open project.</p>
<p><strong>July 2nd:</strong> Today quite a lot was done.
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/32213e322bd7a82677a3d43039c32eb466897406">commit 32213e3</a> updates README.md in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature/PI_retrieval">feature/PI_retrieval</a> to reflect the
new plugin structure.
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/00d4758cb0c52b87de00d037ff9045bc66cc35b7">commit 00d4758</a> adds <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/9baa5fe22414a57658198246f9f0b8c3ee6a49a2/bcfplugin/programmaticInterface.py#L507">pI.addDocumentReference()</a>, which adds a new document
reference to a given topic.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/55f6b2ba17f42f495975574094079a6e82ee4e45">commit 55f6b2b</a> adds <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/9baa5fe22414a57658198246f9f0b8c3ee6a49a2/bcfplugin/programmaticInterface.py#L574">pI.addLabel()</a>, which adds a new label to a given
topic.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/e65fa52f4244bf67db78438a3b53b220474c9b36">commit e65fa52</a> is a rather interesting one: it introduces verbosity levels.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/0af3e03a5279f447e2dfb73790e1c67ae8594ef4">commit 0af3e03</a> adds the function <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/9baa5fe22414a57658198246f9f0b8c3ee6a49a2/bcfplugin/programmaticInterface.py#L602">pI.copyFileToProject()</a>. Its purpose is to
copy a file into the bcf file, so that it can be distributed alongside the bcf
file itself.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/b54acff39b318b7fe8d799f7d2cabe075c6337b8">commit b54acff</a> adds full support for the camera settings in viewpoints.
Now a camera setting of a orthographic camera as well as a perspective camera
can be applied to <cite>FreeCADGui.ActiveDocument.ActiveView</cite>.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/9baa5fe22414a57658198246f9f0b8c3ee6a49a2">commit 9baa5fe</a> made me aware of a bug in writer, which leads to improper
modification of the xml nodes <cite>ModifiedDate</cite> and <cite>ModifiedAuthor</cite>. It also
already sports the beginnings of the fix.</p>
<p><strong>July 1st:</strong> As I already mentioned in the updated README.md on branch
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature/PI_retrieval">feature/PI_retrieval</a> the source code structure had to change. This is what I
have done in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/4bcb1528cd0a8deadfe020599245d8f11bc7de10">commit 4bcb152</a>. Also in this commit I added the function
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/bf8df202f5f74a995ce93a3b42c52f977301a1bf/bcfplugin/programmaticInterface.py#L370">pI.addComment()</a>, which adds a new comment to a topic.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/bf8df202f5f74a995ce93a3b42c52f977301a1bf">commit bf8df20</a> added a new function to <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature/PI_retrieval/bcfplugin/programmaticInterface.py">pI.py</a>. <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/bf8df202f5f74a995ce93a3b42c52f977301a1bf/bcfplugin/programmaticInterface.py#L425">pI.addFile()</a> adds a new
file reference to the header node.</p>
<p>In addition to that I watched yorik's introduction <a class="reference external" href="https://youtu.be/rkWOFQ2fGZQ">video</a> to BIM modeling.</p>
<p><strong>June 28th:</strong> I gained a hell of a lot of understanding about the inner
workings of FreeCAD. Even if I want to put my main effort right now on the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature/PI_retrieval/bcfplugin/programmaticInterface.py">pI</a>
(programmatic interface) the main goal for today was to find out how to set the
camera of the active view to a specified position and orientation. Well I
succeeded with these two main sources: <a class="reference external" href="https://forum.freecadweb.org/viewtopic.php?t=6745">forum-post by teobo</a> and <a class="reference external" href="https://www.freecadweb.org/wiki/index.php?title=Macro_FCCamera">makro
FCCamera by Mario52</a>.</p>
<p>Apart from that I have rewritten the debug, more generally the output system of
my plugin in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/57c0b286eccdb97da4ea66027776867063a49ce8">commit 57c0b28</a>. It now uses FreeCAD's <cite>Console</cite> to print
outputs, if running inside FreeCAD. Otherwise the outputs will be printed to
<cite>stdout/stderr</cite>. <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/b4019892c2ad3ef77bca4c6119e2fe2281c40579">commit b401989</a> further moved the complete debug
functionality into <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature/PI_retrieval/src/bcf/util.py">util.py</a>, which makes kind of more sense than leaving it in
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature/PI_retrieval/src/bcf/project.py">project.py</a>.</p>
<p>My new and gained knowledge of today, about setting the camera's position and
orientation, got baked into a new function of the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature/PI_retrieval/bcfplugin/programmaticInterface.py">pI</a>: <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/2fdc65c449d0838551b623c448491387644c49e2/src/frontend/programmaticInterface.py#L327">pI.activateViewpoint()</a></p>
<p>The best comes at the end: I updated the wiki page on <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature/PI_retrieval">feature/PI_retrieval</a>.
It now explains how to use the plugin inside FreeCAD's python console. The
associated commit is <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/2fdc65c449d0838551b623c448491387644c49e2">commit 2fdc65c</a>.</p>
<p>At this point I want to give a great thanks to the efforts of <a class="reference external" href="https://github.com/qingfengxia">qingfengxia</a> and
<a class="reference external" href="https://github.com/luzpaz">luzpaz</a>. Their <a class="reference external" href="https://github.com/qingfengxia/FreeCAD_Mod_Dev_Guide">eBook on FreeCAD</a> helped me a lot today in finding out how to
modify the camera settings.</p>
<p><strong>June 27th:</strong> Some development work happened today and some work with FreeCAD
and IFC files.</p>
<p>Since today I pushed rather many commits with some sporting only minor changes,
I will only mention the bigger ones below.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/25a0ee8093ce35fad2808d51ec2f58d016bcf2cd">commit 25a0ee8</a> introduces the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/7192ca8abb22d333d430b6549e9703a989c9161f/src/frontend/programmaticInterface.py#L199">pI.getViewpoints()</a> function. It takes a
topic object and returns all viewpoints mentioned in the corresponding
<cite>markup.bcf</cite> file.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/fa5af15c56af2af0fa1fcf82f560e3fb0b1b7a76">commit fa5af15</a> modifies <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/e31d3b3d22fe81deb000505f6c7cd1fd83cb8d8e/src/frontend/programmaticInterface.py#L142">pI.getComments()</a> in a way that it now also
accepts an optional viewpoint object, in addition to the topic object, and
returns a sorted list of comments mentioning that specific viewpoint.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/e56747fa315171fdfa1be3c5c3ca53caa15e627b">commit e56747f</a> adds the function <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/7192ca8abb22d333d430b6549e9703a989c9161f/src/frontend/programmaticInterface.py#L228">pI.getRelevantIfcFiles()</a>. It returns the
list of files listed in the header node of <cite>markup.bcf</cite>.</p>
<p>Although <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/7192ca8abb22d333d430b6549e9703a989c9161f">commit 7192ca8</a> does not add that many new lines, it is quite
significant. It adds the file <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature/PI_retrieval/src/BCFPlugin.FCMacro">BCFPlugin.FCMacro</a>. The plugin is now already
usable, to an extent, inside FreeCAD, without the gui, however. The wiki page
will be updated tomorrow, still on branch <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature/PI_retrieval">feature/PI_retrieval</a>.</p>
<p>To explain a bit more about the work I put into FreeCAD and IFC files: first I
wanted to know how IFC files can be opened using FreeCAD, after that was
accomplished, using <a class="reference external" href="https://github.com/IfcOpenShell/IfcOpenShell">IfcOpenShell</a>, I searched for the IFC attributes (like the
id of an ifc object) and where it is stored in the document. Result was: inside
the class <cite>BuildingPart</cite> the member <cite>IfcAttributes</cite> exists which is filled with
the attributes I want, at least I think so.</p>
<p><strong>June 26th:</strong> Today a considerable amount of work was done in
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature/PI_retrieval/bcfplugin/programmaticInterface.py">./src/frontend/programmaticInterface.py</a>. This file is beeing developed on the
new branch <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature/PI_retrieval">feature/PI_retrieval</a>. The first <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/1038be1025ec47c5e40d6544dc73c930bb67d5f0">commit 1038b31</a> integrated the
<cite>defaultValue</cite> member of <cite>SimpleElement</cite> and <cite>Attribute</cite> in every
<cite>getEtElement()</cite> method. For more information please see the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/1038be1025ec47c5e40d6544dc73c930bb67d5f0">commit 1038b31</a>
and its commit message.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/59d1ca8d53c388ca88c749fde4563484cd1397ab">commit 59d1ca8</a> changed the validation mode of <a class="reference external" href="https://xmlschema.readthedocs.io/en/latest/">xmlschema</a> from 'strict' to
'lax', which means that a list of error messages, if there are some, is
generated and returned with the decoded XML file, instead of throwing
exceptions.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/2c888758dca22a0246456eed056d5a84c715e076">commit 2c88875</a> added to <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature/PI_retrieval/bcfplugin/programmaticInterface.py">programmaticInterface.py</a> (<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature/PI_retrieval/bcfplugin/programmaticInterface.py">pI.py</a> for short)
the functions <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/e31d3b3d22fe81deb000505f6c7cd1fd83cb8d8e/src/frontend/programmaticInterface.py#L84">openProject()</a> and <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/e31d3b3d22fe81deb000505f6c7cd1fd83cb8d8e/src/frontend/programmaticInterface.py#L107">getTopics()</a>. Please see the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/2c888758dca22a0246456eed056d5a84c715e076">commit
2c88875</a> and its message for more information</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/e31d3b3d22fe81deb000505f6c7cd1fd83cb8d8e">commit e31d3b3</a> adds <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/e31d3b3d22fe81deb000505f6c7cd1fd83cb8d8e/src/frontend/programmaticInterface.py#L142">getComments()</a> to <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature/PI_retrieval/bcfplugin/programmaticInterface.py">pI.py</a> and prints out all validation
errors if there were some. Also if some required node/attribute in a <cite>viewpoint.bcf</cite>
file is missing then this file is skipped.</p>
<p><strong>June 25th:</strong> Again some things happened outside of the git repo, like filling
out the first evaluation form from <a class="reference external" href="https://summerofcode.withgoogle.com/">summerofcode.withgoogle.com</a> or reading
more about the model view paradigm in Qt.
Apart from this still a little dev work has taken place today: <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/cf73654d45223c68c0070b0ce08b56135a35df0c">commit cf73654</a>
renames <cite>Topic.refs</cite> -&gt; <cite>Topic.docRefs</cite> and <cite>frontendInterface.deleteObject()</cite>
now uses <cite>writer.addProjectUpdate()</cite> instead of <cite>writer.addUpdate()</cite>. Both
accomplish the same, but former is safer to use.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/4d170a72d69e279461c21fc59b8a8f5f4c374d39">commit 4d170a7</a> introduces many new comments of functions and already converts
some comments to the official docstring format, as mentioned in yesterdays log
entry.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/6f4b105f523d3a9ad3aa541e3c7ccce5a749a403">commit 6f4b105</a> adds function <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/6a63191c0fb5f6d4e56eaccc6697e73b0140d190/src/bcf/writer.py#L993">writer.createBcfFile()</a>. This function
compresses the contents of the directory passed as parameter to a zip archive
that complies with the <a class="reference external" href="https://github.com/BuildingSMART/BCF-XML/tree/master/Documentation#bcfzip-encoding-guide">requirements for BCF archives</a>.</p>
<p><strong>June 24th:</strong> I finally found the bug in the test suite for <cite>frontentInterface.deleteObject()</cite>!
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/ab09e0a594d1d7a7401ee5e6ea7e81e01a5d40dc">commit ab09e0a</a> is the one in question for this change. In addition to that I
started a little refactoring session and I am moving now to the official
docstrings of python in order to generate nice documentation through <a class="reference external" href="https://docs.python.org/3/library/pydoc.html">pydoc</a>.
For the UI part I started to look into the model view paradigm, and how this is
done in Qt.</p>
<p><strong>June 22nd:</strong> I have written exclusively on the wiki page today as well as
created a (hopefully) informative Readme that gives a crash course on how to use
the plugin in its current state.
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/wiki">Here</a> you will find the wiki page now accompanying the plugin.</p>
<p>If you jump straigth to the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/">repo</a> you will find the new front page with the
extended README.</p>
<p><strong>June 21st:</strong> Today I added a few minor commits. The first beeing <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/3dcb2275a74684bf6da9473856c5493ef31dce1e">commit
3dcb227</a> in which I finally deleted the class <cite>Modification</cite>, which got split
up into <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/59adbab0bee1b72544c8c219106f4eff4d3e206e/src/bcf/modification.py#L13">modification.ModificationAuthor</a> and <cite>modification.ModificationDate</cite>.
For more info please see the log entry of June 19th.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/8ec8c6ff492ac15ea394ba7a76972c6fb10a789a">commit 8ec8c6f</a> replaced the debug <cite>print</cite> instructions with the a call of the
<cite>project.debug()</cite> function, in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/tests/writer_tests.py">writer_tests.py</a>.</p>
<p>After some debugging I added a <cite>tearDown()</cite> function to the test cases in
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/tests/writer_tests.py">writer_tests.py</a>, done in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/c5cce73d2c9bf99f5fe85d0c0ac751b58f0bfcc0">commit c5cce73</a>. Reason beeing that I noticed
strange behavior after I added a test case for adding a whole new topic to a BCF
file. Specifically most test cases failed if run together, but succeeded when
run separately. Reason being that the extracted BCF file wasn't completely
replaced for each new test case, instead it was merely updated. This meant that
the added topic would be read in too by the following test case and thus
invalidate some invariants.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/f91b8633b5fb5870f404e713f4cc7bd8de347bb9">commit f91b863</a> added a diagram of the basic structure of the plugin, for the
purpose of the wiki page which I am currently writing.</p>
<p>In <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/f7a495888d783ac4ec10b93ffc8aaa1752a792ea">commit f7a4958</a> I added a whole new file <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature_interface_deleteObject/src/bcf/frontendInterface.py">frontentInterface.py</a> with a new
function <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/e56123307c964cf693083e8adc5b959940c006b2/src/bcf/frontendInterface.py#L11">frontentInterface.deleteObject()</a>. Both currently reside on the
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature_interface_deleteObject">branch feature_interface_deleteObject</a> branch. This new function shall handle the
complete deletion of an object, by that I mean the deletion from the file,
through the <cite>writer</cite> module, and the deletion from the data model, through an
also added function <cite>deleteObject()</cite> inside of <cite>Project</cite>.</p>
<p>Finally <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/e56123307c964cf693083e8adc5b959940c006b2">commit e561233</a> added a new test suite, intended for testing the
functions of <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/feature_interface_deleteObject/src/bcf/frontendInterface.py">frontentInterface.py</a>. It currently already sports 7 test cases.</p>
<p><strong>June 20th:</strong> <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/fed05f2871d43230b9b882041f7011a6a93dc788">commit fed05f2</a> renames the Identifiable interface to
XMLIdentifiable and adds a new Identifiable interface. The new interface is
implemented by nearly all classes in the data model and assigns them, upon
creation, a unique id. This enables an efficient search algorithm that uses an
object's id to get the corresponding reference in the data structure. The
Interface <cite>XMLIdentifiable</cite> is now only used to hold ids that are read in from
the BCF file.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/a0c4f8dad5c7e2d56244c870809ee33b31981387">commit a0c4f8d</a> implements the <cite>searchObject()</cite> function, in nearly all
classes. This function empowers a depth first approach for finding an element.
In addition to this function test cases were added to test it for proper
function.</p>
<p>Locally I am currently working on the first part of the <cite>data model &lt;-&gt;
frontent</cite> interface. I am implementing a <cite>deleteObject()</cite> function that deletes
the object from the BCF file and from the data structure. But since it is
currently under development I didn't already push it.</p>
<p><strong>June 19th:</strong> Today most work got into thinking about how to do the interface
between the data model and the GUI or the python interface for nonGUI mode
respectively.
Apart from thinking however I also pushed a major <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/8ceb3e8b18c39a2c25b5d638e5337260105be45d">commit 8ceb3e8</a>. It adds
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/8ceb3e8b18c39a2c25b5d638e5337260105be45d/src/bcf/writer.py#L686">writer.modifyElement()</a>, <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/8ceb3e8b18c39a2c25b5d638e5337260105be45d/src/bcf/writer.py#L842">writer.processProjectUpdates()</a> as well as helper
functions. <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/8ceb3e8b18c39a2c25b5d638e5337260105be45d/src/bcf/writer.py#L686">writer.modifyElement()</a>, apart from <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/647b6845ae819e1175de2539e27ec42a08c45f1a/src/bcf/writer.py#L380">writer.addElement()</a> and
<cite>writer.deleteElement()</cite>, also takes the old value of the modified element as
parameter. This is necessary to find the correct element (attribute or simple
element) in the xml file.
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/8ceb3e8b18c39a2c25b5d638e5337260105be45d/src/bcf/writer.py#L842">writer.processProjectUpdates()</a> has the purpose of iterating over a list of
updates to the <cite>project</cite> object and calling the respective handler function
(<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/8ceb3e8b18c39a2c25b5d638e5337260105be45d/src/bcf/writer.py#L748">writer.handleAddElement()</a>, <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/8ceb3e8b18c39a2c25b5d638e5337260105be45d/src/bcf/writer.py#L776">writer.handleDeleteElement()</a> and
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/8ceb3e8b18c39a2c25b5d638e5337260105be45d/src/bcf/writer.py#L801">writer.handleModifyElement()</a>). If some error occured during the update the
errorenous update is returned, in case of success it returns <cite>None</cite>.
Also in this commit I added a list <cite>writer.projectSnapshots</cite> which holds an
arbitrary number of the latest n updates. This is supposed to fuel the undo
operation, and will be used in the future.
As always for a bit more of information please see the respective <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/8ceb3e8b18c39a2c25b5d638e5337260105be45d">commit
8ceb3e8</a></p>
<p><strong>June 18th:</strong> <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/3765658dfd50f77a85252bb3904c554eb61b5086/src/bcf/writer.py#L587">writer.deleteElement()</a> is finished! (except for proper
documentation) Finishing commit is <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/3765658dfd50f77a85252bb3904c554eb61b5086">commit 3765658</a>. <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/3765658dfd50f77a85252bb3904c554eb61b5086/src/bcf/writer.py#L587">writer.deleteElement()</a>
now distinguishes between an identifiable element (one whose object is an
instance of <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/interfaces/identifiable.py">interfaces.Identifiable</a>), a non identifiable element and an
attribute. All have to be handled in a different manner to one another or can be
handled in an easier way than another element type.
Other changes that were implemented while writing on <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/3765658dfd50f77a85252bb3904c554eb61b5086/src/bcf/writer.py#L587">writer.deleteElement()</a>:</p>
<ul class="simple">
<li>the interface <cite>interfaces.Identifiable</cite> now only holds IDs of type UUID, for
more info please see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/a18599a99a55745edaaa6551d5e7088c996b5a77">commit a18599a</a>.</li>
<li>project now implements a debug function <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/addc02e58351adb55e584912d5060f3ae2a299dc/src/bcf/project.py#L13">project.debug()</a> as it was morphed to
the main place to handle debug prints. It also uses the <a class="reference external" href="https://docs.python.org/3/library/inspect.html">inspect</a> module to
get the name of the calling function. For more information please refer to
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/addc02e58351adb55e584912d5060f3ae2a299dc">commit addc02e</a>.</li>
<li>6 test cases were added for <cite>writer.deleteElement()</cite>. You can find them in
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/tests/writer_tests.py">writer_tests.py</a>
</li>
<li>
<cite>modification.Modification</cite> which formerly housed a member <cite>author</cite> and
<cite>date</cite> is now split up into <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/59adbab0bee1b72544c8c219106f4eff4d3e206e/src/bcf/modification.py#L13">modification.ModificationAuthor</a> and
<cite>modification.ModificationDate</cite>. This makes it easier to handle in the
<cite>writer</cite>-module. For more information see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/59adbab0bee1b72544c8c219106f4eff4d3e206e">commit 59adbab</a>.</li>
<li>
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/bcf/util.py">util.py</a> got two new functions: <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/3765658dfd50f77a85252bb3904c554eb61b5086/src/bcf/util.py#L152">util.updateSchemas()</a> and
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/3765658dfd50f77a85252bb3904c554eb61b5086/src/bcf/util.py#L173">util.copySchemas()</a>. These were added in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/3765658dfd50f77a85252bb3904c554eb61b5086">commit 3765658</a> and are used to
manage local copies of the schema files.</li>
</ul>
<p><strong>June 17th:</strong> As expected I had to put everything today into the project on
university :/</p>
<p><strong>June 16th:</strong> Today I paused. Tomorrow I will have to invest time into the
project at university, so I don't know whether I come to do much work on FreeCAD
tomorrow either. June 18th I will be back working on <cite>writer.deleteElement()</cite>
again!</p>
<p><strong>June 15th:</strong> <cite>writer.deleteElement()</cite> is not finished yet, work is still done
locally. On master <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/9f04faf2515be3b3b0f4d0c511864a7dd74a8bc7">commit 9f04faf</a> comprises some notable changes to
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/bcf/writer.py">./src/bcf/writer.py</a>. Most notably is the renaming and enhancing of
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/647b6845ae819e1175de2539e27ec42a08c45f1a/src/bcf/writer.py#L279">writer.getContainingETElementForAttribute()</a> as well as the addition of new
testcases for this renamed function. But for more information please see the
commit message as it is quite elaborate.</p>
<p>The current state of <cite>writer.deleteElement()</cite> is that elements, whose types
inherit from <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/interfaces/identifiable.py">interfaces.Identifiable</a>, can be deleted.</p>
<p>Additionally to the first two points I thought about how to handle modifications
of the data model. Should there be a separate function <cite>writer.modifyElement()</cite>
or could it also be constructed out of <cite>writer.deleteElement()</cite> and
<cite>writer.addElement()</cite>? Answer is: it could be constructed. But with the
implications that either:</p>
<ul class="simple">
<li>every change is written instantaneously to disk and the data model stays
coherent with the bcf file. The disadvantag is that batchable updates are not
possible and it may use quite a lot of CPU time.</li>
<li>Or for every modification a snapshot of the data model is stored, with the
modified object in a list. This list is then processed chronological. This
preserves the possibility of issuing batched updates, but might use a
significant amount of memory.</li>
</ul>
<p><strong>June 14th:</strong> Today I finally finished the unit tests for
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/647b6845ae819e1175de2539e27ec42a08c45f1a/src/bcf/writer.py#L380">writer.addElement()</a>, for information on what it does please refer to the
function documentation as it is quite extensive and the function can handle
pretty much. The unit tests are to be found in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/tests/writer_tests.py">writer_tests.py</a>, and they were
finished in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/c0e43177fccd637b046f8e0645f3d856fce6b053">commit c0e4317</a>. Additionally to the unit tests this commit also
comprises refactorization of <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/647b6845ae819e1175de2539e27ec42a08c45f1a/src/bcf/writer.py#L279">writer.getContainingETElementForAttribute()</a>,
a bugfix in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/647b6845ae819e1175de2539e27ec42a08c45f1a/src/bcf/writer.py#L230">writer.getInsertionIndex()</a>, a change in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/647b6845ae819e1175de2539e27ec42a08c45f1a/src/bcf/project.py#L68">project.SimpleList</a> and
the addition of <cite>getEtElement()</cite> in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/647b6845ae819e1175de2539e27ec42a08c45f1a/src/bcf/project.py#L29">project.SimpleElement</a>. But for more
information please refer to the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/c0e43177fccd637b046f8e0645f3d856fce6b053">commit c0e4317</a>.</p>
<p>Then the second big commit is <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/647b6845ae819e1175de2539e27ec42a08c45f1a">commit 647b684</a>. In it I refactored the
assignment of the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/647b6845ae819e1175de2539e27ec42a08c45f1a/src/interfaces/hierarchy.py#L9">Hierarchy.containingObject</a> member variable of classes
implementing <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/interfaces/hierarchy.py">Hierarchy</a>. I moved it from the reader module to the individual
constructors which makes more sense, I think.</p>
<p>Currently I am starting my work on <cite>writer.deleteElement()</cite>.</p>
<p><strong>June 13th:</strong> All work today was done on <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/unit_tests">branch unit_tests</a>. Today one
commit, <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/24558c2a56c078d18b8f63b256ca5cc8ada7456e">commit 24558c2</a>, was added. In short: this commit adds two new test
cases and rewrites <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/647b6845ae819e1175de2539e27ec42a08c45f1a/src/bcf/writer.py#L230">writer.getInsertionIndex()</a>. The result of this function is
now the greatest index possible at which an element could be inserted. Now you
will also find yesterdays work in the commits:</p>
<ul class="simple">
<li>
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/2593bdb5a889e8ec4c531bd0e675c9ce65648eb5">commit 2593bdb</a>: <cite>writer.py: viewpoints can now be added</cite>
</li>
<li>
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/4de50788af938d69f00fac01848ee7771d805ae1">commit 4de5078</a>: <cite>writer.py: compileChanges() function added</cite>
</li>
<li>
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/72a63ff187a551f8fb75cc0d879112222b193a10">commit 72a63ff</a>: <cite>ADD writer_tests.py: unit tests for writer.py</cite>
</li>
</ul>
<p><strong>June 12th:</strong> Viewpoint objects can now be added, resulting in the generation
of a new viewpoint file in the corresponding topic directory, for more
information please refere to <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/2593bdb5a889e8ec4c531bd0e675c9ce65648eb5">commit 2593bdb</a>. <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/4de50788af938d69f00fac01848ee7771d805ae1">commit 4de5078</a> adds the
function <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/4de50788af938d69f00fac01848ee7771d805ae1/src/bcf/writer.py#L400">writer.compileChanges()</a>. It is not that long or complicated, but the
most stuff goes on under the hood of the function call in line
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/4de50788af938d69f00fac01848ee7771d805ae1/src/bcf/writer.py#L415">writer.compileChanges()#415</a>. It results in a depth first search objects that
don't are in the original state. Hence every data model class had to be edited.
Currently I am working locally on unit tests for the <cite>writer.addElement()</cite>
method for which I have 11 testcases planned. I will probably push them tomorrow
upstream.</p>
<p><strong>June 11th:</strong> with <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/645a0f073c102ca82315e026b6a4c66f8b68faea">commit 645a0f0</a> I added support for all attributes that are
optional, to be added (at least the ones defined in <cite>markup.xsd</cite>). Currently I
am not supporting the addition of whole new projects, and viewpoints are not
mutable, so once after they are saved they stay. Then locally I am currently
implementing the addition of a whole viewpoint file. Probably tomorrow it will
be merged into master and pushed upstream.</p>
<p><strong>June 10th:</strong> <cite>writer.addElement()</cite> function is again further finished. It now
has the capability of adding attributes to <cite>File</cite> elements in the header. For
more information see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/da46aa438402fd7fe8be17d4ead232bc54ab6afe">commit da46aa4</a>, also <cite>markup.HeaderFile</cite> was added, for
more information please refere to the commit message. <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/78ac6ce0eac8f3e9dedf6d2ab89f5f0d40430842">commit 78ac6ce</a>
introduces <cite>project.SimpleElement</cite>, <cite>project.SimpleList</cite> and
<cite>project.Attribute</cite>. They are used to represent the values of simple
elements, lists of simple elements or attribues respectively. But they also
inherit <cite>XMLName</cite>, <cite>Hierarchy</cite> and <cite>State</cite> so they can be treated like any other
representation of an element.</p>
<p><strong>June 9th:</strong> In <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/2afab2ddd410761e864f73888085836b717c1820">commit 2afab2d</a> I implemented half of <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/interfaces/xmlname.py">XMLName</a> interface
for all classes. This interface defines a property <cite>xmlName</cite> that each class
inherits. By default this property is set to the name of the class, but the
constructor of <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/interfaces/xmlname.py">XMLName</a> also offers the possibility to define a custom name
(this is needed for the writer module). Second to the <cite>xmlName</cite> property it
defines a member function <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/3eeb7f8356ad664ad9ac40a31a7a1c58dfb74a16/src/interfaces/xmlname.py#L16">XMLName.getEtElement(element)</a> that shall receive an
<cite>xml.etree.ElementTree.Element</cite> object and shall extend it with its properties,
and return it again. It is expected that the returned element is schema conform
and can be inserted as it is.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/e0130434581c59e5ce490a078e1b262ddfd3c449">commit e013043</a> finally removed <cite>SchemaConstraint</cite> and its decendants, since
it was actually unnecessary.</p>
<p><a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/3eeb7f8356ad664ad9ac40a31a7a1c58dfb74a16">commit 3eeb7f8</a> added to the writer the functionality of adding objects of
type comment into the corresponding <cite>markup.bcf</cite> file.</p>
<p><strong>June 8th:</strong> I have worked on the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/647b6845ae819e1175de2539e27ec42a08c45f1a/src/bcf/writer.py#L380">writer.addElement()</a> method. All work is
still local and not finished. The overall strategy for the writer module is to
read in the corresponding XML file using <a class="reference external" href="https://docs.python.org/3.3/library/xml.etree.elementtree.html">xml.etree.ElementTree</a>, add the new
elements in this structure and write it to the file again.</p>
<p><strong>June 7th:</strong> Other than beginning a new blog post about the writer module and
how I envision it, I didn't come to much today.</p>
<p><strong>June 6th:</strong> Most work today was organisatorial: had correspondence with
<a class="reference external" href="https://github.com/teocomi">Matteo Cominetti</a> as well as with Paul Deckers (a Product Specialist at the
BIMcollab Support Team) about the topic of handling non conform schema files.
This topic bugs me! For the writer module I am starting to write, I started a
list that contains the elements that shall be updateable/addable and deleteable,
will be available in a future commit.
On to the development: <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/d6c6cc5f69a1b179eebae8701e86e178146a02bb">commit d6c6cc5</a> I added an own class for the labels of
a topic. This class (<cite>Labels</cite>) inherits from list and also inherits the
<cite>Hierarchy</cite> interface, that I introduced yesterday. The initialisation of a
<cite>Topic</cite> object is unchanged, in the init function the list of string labels is passed
to the constructor of <cite>Labels</cite>. The inheritance from <cite>Hierarchy</cite> offers the
reader the possibility of easily generating the path that leads down to the
corresponding label element in the XML file.
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/de38b48c9fcc200316741e85624b82275a99485b">commit de38b48</a> adds the parameter <cite>guid</cite> to the constructor of <cite>Comment</cite>.
Till today I overlooked it, which lead me to a pseudo problem. Without the Guid
of a comment I would have had the problem of uniquely identifying the comment
that shall be updated or deleted by the writer module. Additionally the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/de38b48c9fcc200316741e85624b82275a99485b">commit
de38b48</a> finishes the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/de38b48c9fcc200316741e85624b82275a99485b/src/bcf/writer.py#L61">writer.getUniqueIdOfListElementInHierarchy()</a> function
that generates the hierarchy of a given element and checks if it contains an
element that only occurs in a list, if that is the case then the unique id of
that list element is returned.</p>
<p><strong>June 5th:</strong> Today I finally followed the suggestion of @yorik and replaced my
own code for getting the path to the temporary folder with the python module
<cite>tempfiles</cite>, for more information see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/5616fd92e0a6e1d83cd99cae0ff85f7689ae0b99">commit 5616fd9</a>. <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/ac589c8fff50d9aa2ad63a70b92479277cd6cd38">commit ac589c8</a> is a
small one, but with some repercussions. In it I added <cite>_viewpoint</cite> to the
initialization sequence of the <cite>markup.__init__()</cite> function. Without it I
wouldn't have been able to use the property <cite>markup.viewpoint</cite>. The amount the
previous commit was smaller than usual <cite>commit c9f9ea4</cite> is larger. In it I
realized some conceptual stuff, like already implementing three interfaces in
many classes, that will make the writer module easier to write and more
maintainable. For this I added the <cite>./src/interfaces</cite> folder. It is its own
python package, and defines three modules/interfaces (atm):</p>
<ul class="simple">
<li>State: represents the state of an object during the plugin lifetime</li>
<li>Hierarchy: allows an object to know the object it is part of and thereby
somewhat implementing a doubly linked tree. For example consider an object
of <cite>Markup</cite>. It probably has one or more objects of type <cite>Comment</cite>. Now each
comment has a member <cite>containingObject</cite>, which in this case references the
one object of type <cite>Markup</cite> that references it.</li>
<li>Identifiable: allows an object to define a unique Id, if it shall be
uniquely identifiable. This is intended to be used mainly for objects that
can occur multiple times. Like for example <cite>Viewpoint</cite>. Here the Id is the
id defined in the XML file.</li>
</ul>
<p>But please refer to the commit itself for more information, as it has a rather
extensive commit message, describing the interfaces in more detail.</p>
<p>Please note: tomorrow I won't be able to do much. I try to throw in between one
and three hours.</p>
<p><strong>June 4th:</strong> In <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/0557bcc4eddf1175393fc26cd0526e8d0d3d55b9">commit 0557bcc</a> I fixed the issue where the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/9ecb6b1009521a147cc87bf3a37bceb905ca7f22/src/bcf/markup.py#L106">Comment</a> s didn't
have a valid <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/9ecb6b1009521a147cc87bf3a37bceb905ca7f22/src/bcf/markup.py#L43">ViewpointReference</a> object after creation. The member
<cite>Comment.viewpoint</cite> should, after creation, hold a reference to a valid
<cite>ViewpointReference</cite> object that was created in <cite>reader.buildMarkup()</cite>. Actually it was not
implemented till today, I just left a TODO note for me.
In <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/354d2c46cfcf0fc3ee0c97832447b4bc370a9cbf">commit 354d2c4</a> I added new testcases, all for testing the results of
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/9ecb6b1009521a147cc87bf3a37bceb905ca7f22/src/bcf/reader.py#L528">reader.buildViewpoint()</a>. <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/0733b591b3a0871c68bd4e13c72bf80d4ccc986e">commit 0733b59</a> includes fixes of bugs I became
aware of during testing <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/9ecb6b1009521a147cc87bf3a37bceb905ca7f22/src/bcf/reader.py#L528">reader.buildViewpoint()</a>, as well as the
implementation of <cite>__str__()</cite> for some more classes, which helped during
debugging. Then <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/d6cb41c06bf1eb77f4fdd42782e4a61fd4a1a1fd">commit d6cb41c</a> also contains bug fixes and debug prints were
remove, but see more in the commit message. And finally I added the file
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/bcf/writer.py">./src/bcf/writer.py</a> with some dictionaries that I will need for the writer
module.</p>
<p>Last but not least one thing I learned today using git: don't rebase onto
master. Rebase master onto some branches but not the other way around. This
makes things messy.</p>
<p><strong>June 3rd:</strong> A new blog post is ready, this one elaborates a bit on the ideas I
have in regards to handling <a class="reference external" href="posts/handling-non-conform-bcf-files/">non schema conform BCF files</a>. The <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/unit_tests">branch unit_tests</a>
got a few new commits, mainly adding test cases for the <cite>reader.buildTopic()</cite>
and <cite>reader.buildComment()</cite> functions, for more info see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/c94d812af69e05cc0128b32038ab2e01927afeb0">commit c94d812</a>.
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/7a31462cb37e0cc94eebeda8a02af4641ab42ca6">commit 7a31462</a> contains bug fixes for bugs that I became aware of due to the
newly created test cases. Offline I thought for an extended period of time about
how to structure an update in place approach to writing the bcf file, rather
than writing the whole file at once. For this a new blog post is coming this
week.</p>
<p><strong>June 2nd:</strong> I have written on a blog post about how to handle non XSD conform
BCF files (which is not finished, yet). Otherwise I paused development.
Tomorrow it is gonna be picked up again!</p>
<p><strong>June 1st:</strong> Today not much work was done, but here is a little summary. I
implemented the <cite>__eq__()</cite> function in every class I defined, see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/03057542226fde14de0bf312e032ec4e41d23a4b">commit
0305754</a>. This shall help me in the future when I want to write unit tests.
In <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/bcf/reader.py">reader.py</a> I inserted a rather long comment about how the <cite>buildX</cite>
functions, like what they do, what they expect and what they return. Since all
behave the same I have written one big comment to document all of them, but see
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/a05e22b45d3ff86871d5ac14e355cf25e4b45596">commit a05e22b</a>. The branch <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature_read_viewpoint">feature_read_viewpoint</a> got merged into master,
for testing I will create a own testing branch. And I created a package out of
the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/tree/master/src/bcf">src/bcf</a> directory that just exports <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/bcf/reader.py">reader.py</a> and <cite>writer.py</cite> (latter
one I still have to write), for details see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/015c2f6fc162b6dbe15a9c3bc8957679935dd1a6">commit 015c2f6</a>.</p>
<p><strong>May 31st:</strong> Today all work was done on the <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature_read_viewpoint">feature_read_viewpoint</a>-branch.
Most important the function <cite>reader.buildViewpoint()</cite> is finished and with it
the last step was completed to being able to read in a complete BCF file, given
it is validated successful against the XML schemas. For more info see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/2922d71af78845bfbdb05ac571c232cfcfdd5989">commit
2922d71</a>. To test the reader "module" I created two new topics in
<cite>src/bcf/test_data</cite>. One is complete in the way that it defines at least one
element for every node in all files specified by the corresponding XSD file. The
third topic just has a complete header element in <cite>markup.bcf</cite>. For more info
see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/7fa127aec6847d9bd653fe43f345b7ee4eaa992b">commit 7fa127a</a>. Now ViewpointReference has a reference to the
corresponding Viewpoint object. The inheritance approach thrown away because
after reading in all ViewpointReferences from <cite>markup.bcf</cite> the Viewpoint objects
would have been created, but with no relation to their super class. This meant
that an object of the former could not have been used as an object of the latter
without recreation of this object. That further would have complicated the code,
and made it hard to understand and maintain. Therefore composition was chosen in
favor of inheritance. For more info also see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/2922d71af78845bfbdb05ac571c232cfcfdd5989">commit 2922d71</a>.</p>
<p><strong>May 30th:</strong> Added the folder <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/tree/master/src/bcf/test_data">src/bcf/test_data</a> that is intended to contain
test data for testing during development, but not primarily for unit tests now.
Currently it contains an example compliant with the schema files. For more info
see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/6fb72f5bbefddc0a063f67c4d6fa806b68763ee2">commit 6fb72f5</a>. In <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/30b998d12ce4c647abc26a6e42a9a5f0efd872fd">commit 30b998d</a> I changed the type of every variable
associated with <cite>SchemaConstraints</cite> to an elementary type. Reason being that the
<cite>extensions.xsd</cite> file (as my understanding goes) is intended to be specified
in the xml file itself as ... well, an extension to the existing schema.
Finished function <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/3f5fdafb09422e0be0fb10f59f1df76619b2a3ea/src/bcf/reader.py#L350">reader.buildMarkup()</a>, although still a "#TODO" comment is
above the function header. Also in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/aa045980b5f2391b7d93dbf2caa163c6f7f8acac">commit aa04598</a> the class
<cite>DocumentReference</cite> and <cite>BimSnippet</cite> was added. Last but not least: started
working on reading in <cite>viewpoint.bcfv</cite>. But not finished, that is why this
development is still on the branch <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commits/feature_read_viewpoint">feature_read_viewpoint</a>. For more info
refer to <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/154630d4238172610a221dc6ae3c1023c037c553">commit 154630d</a>.</p>
<p><strong>May 29th:</strong> Already started refactoring a bit in <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/master/src/bcf/reader.py">reader.py</a>. Went away from
using <cite>ZipFile</cite> objects when operating on the zipFile to the extracted version
of the zip file instead. Written function <cite>reader.readInFile()</cite> that shall read
the complete BCF file into the data structure (see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/9a791627b16b09e9c6641975e6fb0a9bf7e72856">commit 9a79162</a>). During testing
I noticed that the example BCF file from the <a class="reference external" href="https://www.bimcollab.com/en/Support/Support/Downloads/Examples-templates">bimcollab website</a> is not valid
becaus it defines an empty node <cite>Header</cite> in <cite>markup.bcf</cite> of topic
<cite>ebb1a8bf-6d1d-4aad-a875-61ad3cc40d30</cite> which is prohibited by <cite>markup.xsd</cite> of
BCF version 2.1.</p>
<p><strong>May 28th:</strong> Created a new blog post about the way the schema constraints are
handled now (<a class="reference external" href="posts/schema-constraints-revisited/">schema constraints revisited</a>). Change configuration file of the
blog to reflect the current project, instead of the FreeCAD development blog.
Started a unit-test suite, see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/tree/unit_tests/src/tests">branch unit_tests ./src/tests</a>, and test cases
written for <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/blob/991d967ab5fc00f8960bbc938c727d11e42c950c/src/bcf/reader.py#L145">reader.buildProject()</a>. Written function in <cite>reader.py</cite> that
parses <cite>bcf.version</cite> and returns the version number as string, see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/cccde6ae2bdf52f21f5e7ecfeb68cc89957af29e">commit
cccde6a</a></p>
<p><strong>May 27th:</strong> Complete the python representation of the class diagram <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/0a1081bb1fe26dc729d3a2b708fde491b3a31505">commit
0a1081b</a>. Also advanced to the point where a <cite>.bcf</cite> can be opened, every XML
file be validated (in theory, only tested it with project.bcfp yet) and the
contents of <cite>project.bcfp</cite> are can be written to an object of <cite>Project</cite>. For
more details refer to following commits:</p>
<ul class="simple">
<li>
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/bae270f1127039ae78876bf6f3785c48ec0e30b9">commit bae270f</a>: Add util.py and reader.py</li>
<li>
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/3c0b9d0a1beed02816cd15b0a5186368d7361f7d">commit 3c0b9d0</a>: util.py: add schemaValidate</li>
<li>
<a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/f62ed23a73e209fc69995fccedf4e20beddf7632">commit f62ed23</a>: reader.py: add buildProject</li>
</ul>
<p><strong>May 26th:</strong> Update Comment in class diagram. For more info see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/1c34ad907b7fc56cd96aa2fc5aa133e3f445a24b">commit 1c34ad9</a>, and create <a class="reference external" href="https://forum.freecadweb.org/viewtopic.php?p=310515#p310515">mockup of the plugin interface</a>.
Write part one of the class model in python see <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/commit/31ef931b3637c90ca0c8252f71dd635e66a843fa">commit 31ef931</a>.</p>
</div>
    </div>
    </article><article class="blog-post h-entry post-text"><header><h2 class="p-name entry-title blog-post-title"><a href="posts/writing-non-schema-conform-bcf-files/" class="u-url">Writing non Schema Conform BCF Files</a></h2>
        <div class="metadata blog-post-meta">
            <p class="byline author vcard"><span class="byline-name fn">Patrick Podest</span></p>
            <p class="dateline"><a href="posts/writing-non-schema-conform-bcf-files/" rel="bookmark"><time class="published dt-published" datetime="2019-06-07T16:02:56+00:00" title="2019-06-07 16:02">2019-06-07 16:02</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Wait would you write files with the intention that they don't conform to the
provided XSD files? ... you might ask by just reading the title. No I wouldn't.
As I introduced in my last blog post (<a class="reference external" href="posts/handling-non-conform-bcf-files/">Handling Non-Conform BCF Files</a>), that
was not an update of the dev-logs post, I introduced the need of supporting
files from vendors that might do some things differently. I ended this last post
with a pros and cons list about two approaches that I thought of. In the
meantime I decided for latter one.</p>
<div class="section" id="recap">
<h2>Recap</h2>
<p>The second approach, let's call it update approach, extracts the BCF file to a
temporary folder, reads the contents into memory (that are conform to the
corresponding XSD file) and every time the state in
memory is changed the updates get written to the dicrectory structure in the
temporary folder. At the end, when the plugin is closed and its lifetime ends,
this directory is compressed again and stored in its original location. The
update approach thereby does not alter any data that the plugin didn't load into
memory, it works "around" it.</p>
<p>I think this is the better appraoch, since no exceptions to the rule have to be
made for every speciality that a vendor might incorporate in its files. However,
the writer module has to have an understanding of XML baked in, in order for it
to be able to update these files in place.</p>
<p>In the next section I want to elaborate a bit more on how I envision this writer
module.</p>
</div>
<div class="section" id="writing-actual-stuff">
<h2>Writing actual stuff</h2>
<p>At the beginning of every writing operation it has to be known whether an
existing element shall be modified, a new element shall be added or an existing
one shall be deleted. Following you will find my thoughts, uncompiled, as I have
written them down onto paper. First will be the handling of additions.</p>
<hr class="docutils">
<div class="section" id="how-can-additions-be-handled">
<h3>How can additions be handled?</h3>
<p>Every element class (a class that directly represents a XML-Element like
<cite>Comment</cite>) shall have a function that returns the XML-Text. This text is then
going to be inserted at the right place by the writer module.
The writer module has to crawl through the complete data model to check/compile
a list of objects that were added, changed or deleted. Then for each added
object it calls the XML-Text function to get the corresponding XML-text for each
element. A second function shall give the following information about the
position at which it should be inserted (could also be done with a dictionary,
that way the data model stays clean):</p>
<ul class="simple">
<li>the containing element: the containing element of <cite>Comment</cite> is <cite>Markup</cite>
</li>
<li>the relatie order: a list of elements that preceed the current one in
reverse order. So the immediate predecessor is first in the list. The last
element of the list is the containing element.</li>
<li>if the new element shall be added inside an element that might occur more than
once (e.g.: <cite>ModifiedDate</cite> in <cite>Comment</cite>) then also a unique id of that list
element has to be retrieved.</li>
</ul>
<p>The writer then searches for the containing element in the file and then goes
through the contents of the containing element, searching for the one with the
least index in the relative order list. The text is inserted right after the
closing tag of the chosen element.</p>
<p>Any references should not be handled/checked in the writer module (e.g.: that
the viewpoint guid in the to be written comment object belongs to an actual
existing viewpoint). Such consistency checks are assumed to be handled in the
GUI or the programmatic interface respectively.</p>
</div>
<hr class="docutils">
<div class="section" id="how-can-updates-be-handled">
<h3>How can updates be handled?</h3>
<p>An element either has to occur only once in the corresponding file, or be
identified uniquely by some attribute. Without one of these two constraints the
identification of the right element in the XML-file becomes extremely hard or
cannot be done deterministically.
An object shall be flagged <cite>MODIFIED</cite> iff (=if and only if) a non-list child
element was changed. A change of a list element translates either to an addition
or deletion, or a change of an element that can be identified
deterministically, as described above. In which case the object, containing the
list with one or more items changed, shall not be flagged <cite>MODIFIED</cite>. Each
object shall then contain a list of changed objects, oblivious of whether it
translates to an attribute or element. for each of these objects the writer
module has to gather following information:</p>
<ul class="simple">
<li>element hierarchy: <cite>ModifiedDate</cite> in <cite>Comment</cite> would have
<cite>ModifiedDate</cite> -&gt; <cite>Comment</cite> -&gt; <cite>Markup</cite> as hierarchy list.</li>
<li>unique id of every list element that is in the hierarchy (like with additions)</li>
<li>whether it translates to an attribute or an element</li>
</ul>
<p>The writing module shall collect a list of all elements that are flagged
<cite>MODIFIED</cite>. For each element the writer module shall collect the amount
information listed above. It then follows the element hierarchy of the object in
reverse order till it reaches the changed object itself. At this point the
distinction between attribute and element has to be made. For both cases the
following two steps happen:</p>
<ol class="arabic simple">
<li>the respective substring of the element has to be found and</li>
<li>be replaced entirely by the XML-text generated from the object</li>
</ol>
</div>
<hr class="docutils">
<div class="section" id="how-can-deletions-be-handled">
<h3>How can deletions be handled?</h3>
<p>The writer module compiles a list of all elements to delete. For each element
the following information shall be gathered:</p>
<ul class="simple">
<li>which file is the element contained in</li>
<li>unique id of the element (if available)</li>
<li>name of the element</li>
</ul>
<p>The writer module then searches for the unique id in the specified file that
also matches the element name and deletes it from the start to the end tag.</p>
</div>
</div>
<hr class="docutils">
<div class="section" id="how-shall-the-interface-to-the-writer-look">
<h2>How shall the interface to the writer look?</h2>
<p>The above mentioned crawler has the advantage of alos supporting writing the
file only once. Therefore also being somewhat resource saving.
The writer shall have a function <cite>writeChanges()</cite>. This function receives an
object of type <cite>project</cite> which denotes the starting point of the search. Every
object shall have a variable of enum type. This variable is allowed to take on
one of the following four values:</p>
<ul class="simple">
<li>ORIGINAL</li>
<li>MODIFIED</li>
<li>ADDED</li>
<li>DELETED</li>
</ul>
<p>For each of these states the writer maintains a separate list. Each state has to
be handled differenty during writing. It shall also be possible for the user to
just issue an update of all of these four lists and then subsequently manually
decides the point in time when updates shall be written.
=&gt; <cite>updatechangdLists()</cite> -&gt; <cite>writeChanges()</cite>. Since <cite>writeChanges()</cite> now has to
fulfill two functions: once triggering <cite>updateChangedLists()</cite> and the other time
just take these lists as they are, its argument shall be optional.
For an addition, deletion, update it is important to know in which folder the
to-update file is stored. For this a get topic function shall be implemented.</p>
</div>
</div>
    </div>
    </article><article class="blog-post h-entry post-text"><header><h2 class="p-name entry-title blog-post-title"><a href="posts/handling-non-conform-bcf-files/" class="u-url">Handling Non-Conform BCF Files</a></h2>
        <div class="metadata blog-post-meta">
            <p class="byline author vcard"><span class="byline-name fn">Patrick Podest</span></p>
            <p class="dateline"><a href="posts/handling-non-conform-bcf-files/" rel="bookmark"><time class="published dt-published" datetime="2019-06-01T07:50:16+00:00" title="2019-06-01 07:50">2019-06-01 07:50</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>This post shall just collect some ideas I had about handling BCF files whose
contents may not be (in part) conform to the <a class="reference external" href="https://github.com/buildingSMART/BCF-XML/tree/master/Schemas">XSDs</a> supplied by buildingSmart on
github.</p>
<div class="section" id="why-is-there-a-need-for-that">
<h2>Why is there a need for that?</h2>
<p>Well, during testing with one of the two BCF files I currently have (here the
<a class="reference external" href="https://www.bimcollab.com/Files/Example-Projects/BIMcollab_Example_project_Issues-bcfzip.aspx">link to the first one</a> to download) I wanted to validate each file I read in,
before I read it in, to be (mostly) sure that my code does not throw unexpected
exceptions. But already in <cite>markup.bcf</cite> of the first topic the library I use,
<a class="reference external" href="https://pypi.org/project/xmlschema/">xmlschema</a>, threw an <cite>XMLSchemaValidatorError</cite>. The reason was that the node
<cite>&lt;Header /&gt;</cite> was defined, but it was defined empty, which is prohibited by
<a class="reference external" href="https://github.com/buildingSMART/BCF-XML/blob/master/Schemas/markup.xsd">markup.xsd</a>. So as quick fix I deleted the <cite>&lt;Header /&gt;</cite> node altogether to be
able to test my code somewhat. But now on to the next section.</p>
</div>
<div class="section" id="how-does-xmlschema-report-parsing-errors">
<h2>How does <cite>xmlschema</cite> report parsing errors?</h2>
<p>Before we can go into the problem solution, a little investigation of the
library I am using has to be done. We need to know how it handles the nodes and
attributes that could not be parsed/decoded against the corresponding XSD
file.
For parsing/decoding <a class="reference external" href="https://pypi.org/project/xmlschema/">xmlschema</a> defines the following three <a class="reference external" href="https://xmlschema.readthedocs.io/en/latest/usage.html#xsd-validation-modes">validation
modes</a>:</p>
<blockquote>
<p><strong>strict</strong>: Schemas are validated against the meta-schema. The processor stops
when an error is found in a schema or during the validation/decode of XML
data.</p>
<p><strong>lax</strong>: Schemas are validated against the meta-schema. The processor collects
the errors and continues, eventually replacing missing parts with wildcards.
Undecodable XML data are replaced with None.</p>
<p><strong>skip</strong>: Schemas are not validated against the meta-schema. The processor
doesn't collect any error. Undecodable XML data are replaced with the original
text.</p>
</blockquote>
<p>For the ones, like me, that got confused by the first sentence of the first two modes:
every schema that is read in is itself validated against a schema, the
meta-schema, before it can be used. These modes can be used separately for
reading the schema file and for parsing/decoding a XML file. So for example it
is possible to read the <cite>markup.xsd</cite> in <strong>strict</strong> mode, thereby validating it
against a meta-schema, but then parsing/decoding the <cite>markup.bcf</cite> file in
<strong>lax</strong> or <strong>skip</strong> mode.</p>
</div>
<div class="section" id="in-what-way-can-errors-be-handled">
<h2>In what way can errors be handled?</h2>
<p>Given the modes in which XML files can be read in by <a class="reference external" href="https://pypi.org/project/xmlschema/">xmlschema</a> I could only
think about the following two possibilities on how to handle possible errors:</p>
<ol class="arabic simple">
<li>Just ignore the node that could not be parsed/decoded against the
corresponding schema file. Easy to accomplish with <strong>lax</strong> mode.</li>
<li>Read in the plain XML text for that node, store it somewhere in the data
structure and when writing it all out again just insert the plain XML text into
the right place. Only possible in <strong>skip</strong> mode.</li>
</ol>
<p>The main drawback of number 1 is clearly that the data, that couldn't be read
in, would be lost, or only exist in an earlier version of the BCF file, after
the datastructure got written. It would certainly be easy to implement but does
not offer the user great value if his or her data get lost. This is, however, on
the premise of reading in the file once and writing it once after all changes
have been made in memory.</p>
<p>The second option offers a possibility to circumvent the lost data problem. The
not-parsable elements just get read in plain.</p>
<p>But there may be another option that could use <strong>lax</strong> mode without the data
loss. This option is another approach to writing the contents of the
datastructure to the file. Originally I planned to do it in one sweep when the
user presses the enter key or the save button for that matter.  But then
<a class="reference external" href="https://forum.freecadweb.org/memberlist.php?mode=viewprofile&amp;u=255">hardeeprai</a> from the <a class="reference external" href="https://forum.freecadweb.org/">freecad forum</a> suggested, to another topic, that I
write changes right after the were made. So effectively implementing an update
driven approach to making changes permanent.</p>
<p>So now there are two possible approaches to handling errors that each use a
different validation mode. In the next section I want to list some thoughts I
came up with for each one of these approaches.</p>
</div>
<div class="section" id="approaches-pros-cons">
<h2>Approaches: Pros &amp; Cons</h2>
<div class="section" id="reading-once-and-writing-once">
<h3>Reading once and writing once</h3>
<p>As already established, <strong>skip</strong> mode must be used here with <cite>xmlschema</cite>. For
every member in the data structure it has to be noted somewhere if it could be
read in or not. That would indicate whether the node holds the acutal value of
the intended datatype or if it holds the plain XML text as string.</p>
<p><strong>Advantage:</strong> writing the datastructure is fairly easy</p>
<p><strong>Disadvantage #1:</strong> every class, that represents part of the XML file, has to be
changed in order to house the additional information about every member or a
whole new datastructure has to be created for that.</p>
<p><strong>Disadvantage #2:</strong> the type annotations become invalid, if this approach is
used, which leads to confusion by the ones reading the code.</p>
<p><strong>Disadvantage #3:</strong> the module that reads in the XML file into the data model
becomes much more complex, thereby not aiding the understandability of the code.</p>
</div>
<div class="section" id="updating-the-file-on-the-fly">
<h3>Updating the file on the fly</h3>
<p>Here <strong>lax</strong> mode can be used with <cite>xmlschema</cite>. Still the whole file has to be
read in once, but the parts that could not be parsed/decoded stay in the file and are
not read in. To really be able to update the original file, the datamodel has to
accommodate information for every element if it is new or updated, and therefore
shall be written or not. The overhead here is comparable to the first approach
but every class just needs one additional member to signify a change or that
this object was newly created.</p>
<p><strong>Advantage #1:</strong> (as already mentioned) not so much overhead in the data model
compared to the first approach.</p>
<p><strong>Advantage #2:</strong> The user is not exposed to the danger of losing unsaved
changes, since it is updated every time a new change is committed to the data
representation.</p>
<p><strong>Disadvantage #1:</strong> the module that writes the data to the BCF file has to have
light parsing capabilities or a XML awareness respectively, in order to be able
to edit XML files directly. This does not have to be the case with the first
approach, since we could utilize the <cite>xmlschema</cite> library.</p>
<p><strong>Disadvantage #2:</strong> Objects that get deleted must not be deleted right away
from the data model. Rather a flag has to be set that it is "deleted" and the
corresponding part in the file has to be removed as well. After that it can be
removed from the data model.</p>
<hr class="docutils">
<p>I am gravitating more to the latter option, since it does not interfere with the
type annotations, and therefore does not complicate the whole type situation
in the data model. What I still have to face, however, is the XML aware writer
module. This is going to be fun!</p>
</div>
</div>
</div>
    </div>
    </article><article class="blog-post h-entry post-text"><header><h2 class="p-name entry-title blog-post-title"><a href="posts/schema-constraints-revisited/" class="u-url">Schema Constraints Revisited</a></h2>
        <div class="metadata blog-post-meta">
            <p class="byline author vcard"><span class="byline-name fn">Patrick Podest</span></p>
            <p class="dateline"><a href="posts/schema-constraints-revisited/" rel="bookmark"><time class="published dt-published" datetime="2019-05-28T13:18:31+00:00" title="2019-05-28 13:18">2019-05-28 13:18</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>In an <a class="reference external" href="posts/how-to-represent-extensionxsd-constraints/">older post</a>, one or two weeks back, I've written about a design issue I was
facing when trying to integrate the constraints of <a class="reference external" href="https://github.com/buildingSMART/BCF-XML/blob/release_2_1/Extension%20Schemas/extensions.xsd">extensions.xsd</a> into my
class model. <cite>extension.xsd</cite> defines possible values for the XML nodes:</p>
<ul class="simple">
<li>TopicType</li>
<li>TopicLabel</li>
<li>TopicStatus</li>
<li>SnippetType</li>
<li>Priority</li>
<li>Stage</li>
</ul>
<p>I wanted to ensure that the variables, representing let's say <cite>TopicType</cite>, can
only assume valid values, as defined in <cite>extension.xsd</cite>.  My first idea was to
just define <a class="reference external" href="https://docs.python.org/3/library/enum.html">Enums</a> following the schema. Generally this idea is fine but it
doesn't do so well with version changes. A new version of the BCF-XML standard
would then possibly require more maintenance work than necessary. My aim with
this <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD">BCF plugin for FreeCAD</a> is it to create a data model that requires as
little maintenance work as possible, although the code still has to be adapted
to support any new version.</p>
<p>From the maintenance point of view hardcoded enumerations were not really an option.</p>
<p>The next idea was to create something like dynamic enumerations. These would
have the advantage that the constraint is enforced (i.e.: a variable holding an
enumeration value can only hold a valid value as defined in the enumeration
itself). I knew it was possible to change a class object (not the object <em>of</em> a
class) during runtime and add or remove members from it.  I thought maybe this
is also possible with classes that derive from <cite>Enum</cite>. In python to create an
enumeration you just have to define a class like this:</p>
<pre class="code python"><a name="rest_code_28961d1f373348e78c69c7d9b79bcb1e-1"></a><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<a name="rest_code_28961d1f373348e78c69c7d9b79bcb1e-2"></a>
<a name="rest_code_28961d1f373348e78c69c7d9b79bcb1e-3"></a><span class="k">class</span> <span class="nc">Example</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<a name="rest_code_28961d1f373348e78c69c7d9b79bcb1e-4"></a>  <span class="n">VAL1</span> <span class="o">=</span> <span class="mi">1</span>
<a name="rest_code_28961d1f373348e78c69c7d9b79bcb1e-5"></a>  <span class="n">VAL2</span> <span class="o">=</span> <span class="mi">2</span>
<a name="rest_code_28961d1f373348e78c69c7d9b79bcb1e-6"></a>  <span class="o">...</span>
</pre>
<p>The first obstacle was that classes can only derive from a class (that itself
derives from <cite>Enum</cite>) iff they don't introduce new members. Otherwise this would
break some invariants the python interpreter has over enumerations.
The second obstacle was a logical implication of the first: if subclasses
couldn't add new members to an enum-super-class then it is also not possible to
add new members to enumerations during runtime.</p>
<p>So another solution had to be thought of. I maintained the basic structure I
had envisioned for the dynamic enumeration solution. Namely one superclass
called <cite>SchemaConstraint</cite> and one subclass for each of the above mentioned XML
nodes. Every piece of code that wants to represent one of these XML nodes would
store an object of one of the subclasses in a variable of type <cite>SchemaConstraint</cite>.
The actual value of the object is stored in a class variable, <cite>value</cite>, that
holds just any value of type string. This approach of course has the downside that
basically any value can be assigned to the variable <cite>value</cite>, if not restricted.
In order to change this I made the class variable <cite>value</cite> a property where the
setter checks whether the new value is actually a valid value.</p>
<p>Now the question arises: How does the setter function know which value is valid?
Every node has different valid values!</p>
<p>To solve this issue I introduced, for one, the list <cite>validValues</cite> into
<cite>SchemaConstraints</cite> (<cite>value</cite> does also reside there) and, for the other, a
static function called <cite>parseConstraints(elementName)</cite>. This static function
reads the valid values for the XML node <cite>elementName</cite> from <cite>extension.xsd</cite> and
returns them as list.  <cite>parseConstraints()</cite> is intended to be called from the
<cite>__init__()</cite> function of each one of the sub classes (e.g.:
<cite>TopicType.__init__()</cite>). To make things clearer I put a small code example below
showing the classes <cite>SchemaConstraints</cite> and <cite>TopicType</cite> as well as all the
members of both classes.</p>
<pre class="code python"><a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-1"></a><span class="k">class</span> <span class="nc">SchemaConstraint</span><span class="p">:</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-2"></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">validValues</span><span class="p">):</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-3"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">validValues</span> <span class="o">=</span> <span class="n">validValues</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-5"></a>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-6"></a>  <span class="nd">@property</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-7"></a>  <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-8"></a>    <span class="o">...</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-9"></a>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-10"></a>  <span class="nd">@value.setter</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-11"></a>  <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newValue</span><span class="p">):</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-12"></a>    <span class="o">...</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-13"></a>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-14"></a>  <span class="nd">@property</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-15"></a>  <span class="k">def</span> <span class="nf">validValues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-16"></a>    <span class="o">...</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-17"></a>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-18"></a>  <span class="nd">@validValues.setter</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-19"></a>  <span class="k">def</span> <span class="nf">validValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newValue</span><span class="p">):</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-20"></a>    <span class="k">pass</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-21"></a>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-22"></a>  <span class="nd">@staticmethod</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-23"></a>  <span class="k">def</span> <span class="nf">parseConstraints</span><span class="p">(</span><span class="n">elementName</span><span class="p">):</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-24"></a>    <span class="o">...</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-25"></a>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-26"></a><span class="k">class</span> <span class="nc">TopicType</span><span class="p">(</span><span class="n">SchemaConstraint</span><span class="p">):</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-27"></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-28"></a>    <span class="n">validValues</span> <span class="o">=</span> <span class="n">SchemaConstraint</span><span class="o">.</span><span class="n">parseConstraints</span><span class="p">(</span><span class="s2">"TopicType"</span><span class="p">)</span>
<a name="rest_code_09f9cd8c2a80497fb235fead45ccf328-29"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">TopicType</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">validValues</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">validValues</span><span class="p">)</span>
</pre>
<p>One important thing to note here is that the setter method of <cite>validValues</cite> has
just one line which contains <cite>pass</cite>. This is done in order to ensure that the
set of valid values does not get overwritten, at least not that easily.</p>
<p>This solution has, for one, the advantage of being adaptable, in case new values
get added to the list of valid values and, for the other, through the setter function of <cite>value</cite>
it can be enforced that the state of an object is always valid.</p>
</div>
    </div>
    </article><article class="blog-post h-entry post-text"><header><h2 class="p-name entry-title blog-post-title"><a href="posts/learning-xsd-syntax/" class="u-url">Learning XSD Syntax</a></h2>
        <div class="metadata blog-post-meta">
            <p class="byline author vcard"><span class="byline-name fn">Patrick Podest</span></p>
            <p class="dateline"><a href="posts/learning-xsd-syntax/" rel="bookmark"><time class="published dt-published" datetime="2019-05-15T04:24:35+00:00" title="2019-05-15 04:24">2019-05-15 04:24</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>The main takeaway from the XML Schema Definition Tutorial I went through today
was the following:</p>
<blockquote>
So the node <cite>&lt;xs:sequence&gt;...&lt;/xs:sequence&gt;</cite> is part of the definition of a
complex type, it is also called an indicator. What it does is that it tells the
XML checker that the elements specified inside have to occur in the same order
in the XML document to be valid. Also it specifies what elements may be
contained in the complex node.</blockquote>
<p>This greatly improved my understanding of <cite>visinfo.xsd</cite> which describes how a
<cite>viewpoint.bcfv</cite> file is built. As I learned during design, the representation
of a viewpoint is almost as complex as the representation of the remaining
contents of a BCF file.</p>
<p>I thought about how I coudl read the contents of a BCF into this file structure.
As my brain always does, it thinks through the whole process, from checking if
the given file is valid till the point where all the data resides in an object
in memory. This makes me prone to "reinventing the wheel" as I also design a XSD
parser/checker in my head which I then would use to check the given files before
reading them in. But a quick google search brought up a better option, namely an
offical <a class="reference external" href="https://pypi.org/project/xmlschema/">python library</a> for checking XML files against a schema.</p>
<p>Last but not least: I am pleased to announce that the first draft of the class
diagram is ready. You can find it <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/tree/master/doc">here</a> if you are interested.</p>
</div>
    </div>
    </article><article class="blog-post h-entry post-text"><header><h2 class="p-name entry-title blog-post-title"><a href="posts/finishing-up-the-datamodel-uml/" class="u-url">Advancing to the Viewpoint.bcf part</a></h2>
        <div class="metadata blog-post-meta">
            <p class="byline author vcard"><span class="byline-name fn">Patrick Podest</span></p>
            <p class="dateline"><a href="posts/finishing-up-the-datamodel-uml/" rel="bookmark"><time class="published dt-published" datetime="2019-05-14T03:42:30+00:00" title="2019-05-14 03:42">2019-05-14 03:42</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>In the <a class="reference external" href="https://forum.freecadweb.org/viewtopic.php?p=308095#p308095">forum post</a> yesterday, Yorik pointed out that, although part of the
specification, the BimSnippet does not have to be treated with high priority. He
also referred me to Bernd and Duncan in case of questions arising.
As advised, I will consider the BimSnippet in the data model but probably won't
implement it right away.</p>
<p>The progress I made today was mostly in understanding the BCF specification in
regards to the viewpoint.bcfv file. Multiple viewpoint files can be contained
within the folder of one topic. At the beginning of the day I thought that the
data model would be finished rather quick but as it turned out the documentation
on it is not as concise as one might wish it to be. To be more precise: the
whole section about the "Components" element is a bit confusing. It lists
multiple "properties", like <cite>Selection</cite> and <cite>Visibility</cite>. My intuition says that
<cite>Selection</cite> contains a list of components that are selected, and <cite>Visibility</cite>
specifies whether these components shall be visible or not. But in reality each
contains a list of components onto which the values of the attributes of the
respective property shall be applied.</p>
<p>This is a bit confusing at first, and still is for me. Because of this ambiguity
I decided, for the further data model design, that refer to the related XML
schemas rather than the written documentation. For example here you can find the
schema for the <a class="reference external" href="https://github.com/buildingSMART/BCF-XML/blob/master/Schemas/visinfo.xsd">viewpoint.bcf</a> file.</p>
<p>But since the last time I have worked with XML schemas was in vocational school
(I think 2012) I have to refresh my memory on it. For that I will go through the
relevant parts of the <a class="reference external" href="https://www.w3schools.com/xml/schema_intro.asp">W3CSchools: XML Schema Tutorial</a>. Tomorrow.</p>
</div>
    </div>
    </article><article class="blog-post h-entry post-text"><header><h2 class="p-name entry-title blog-post-title"><a href="posts/representing-markupbcf-in-uml/" class="u-url">Representing markup.bcf in UML</a></h2>
        <div class="metadata blog-post-meta">
            <p class="byline author vcard"><span class="byline-name fn">Patrick Podest</span></p>
            <p class="dateline"><a href="posts/representing-markupbcf-in-uml/" rel="bookmark"><time class="published dt-published" datetime="2019-05-13T17:43:03+00:00" title="2019-05-13 17:43">2019-05-13 17:43</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Today I mostly finished the UML class diagram in regard to representing the data
of the <tt class="docutils literal">markup.bcf</tt> file. One think I found kind of interesing while creating
the diagram is that in the <a class="reference external" href="https://github.com/BuildingSMART/BCF-XML/tree/master/Documentation">BCF-XML-Documentation</a> There is no link between a
topic and a comment, so no id of one is stored in the other. That didn't make
sense at first because I thought that one <tt class="docutils literal">markup</tt> could have multiple topics,
which is <strong>not</strong> the case.</p>
<p>However one think what is not that obvious to me is the case with the <tt class="docutils literal">BIMSnippet</tt>.
On the documentation page it says that: "BimSnippet is an additional file containing
information related to one or multiple topics.". This would imply that there
would be more topics inside one <tt class="docutils literal">markup.bcf</tt> file, because <tt class="docutils literal">BimSnippet</tt> is,
as I understand, also just a node inside <tt class="docutils literal">markup.bcf</tt>.</p>
<p>Regarding the open question from the previous post: How to represent constraints
defined in <tt class="docutils literal">extensions.xsd</tt>; I thought about it a little today and came to the
conclusion that it would be the best approach to go with the last option I
listed. That means that for every node, for which constraints are listed in
<tt class="docutils literal">extensions.xsd</tt>, an empty enumeration/class is created which then, during
runtime, gets populated with the valid values.</p>
<p>UPDATE (2019-05-13): The inconsistency is resolved. The BimSnippet node just references one
file that does not have to be inside the topic folder.</p>
</div>
    </div>
    </article><article class="blog-post h-entry post-text"><header><h2 class="p-name entry-title blog-post-title"><a href="posts/how-to-represent-extensionxsd-constraints/" class="u-url">How to represent extension.xsd constraints</a></h2>
        <div class="metadata blog-post-meta">
            <p class="byline author vcard"><span class="byline-name fn">Patrick Podest</span></p>
            <p class="dateline"><a href="posts/how-to-represent-extensionxsd-constraints/" rel="bookmark"><time class="published dt-published" datetime="2019-05-12T15:54:21+00:00" title="2019-05-12 15:54">2019-05-12 15:54</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>So by now this <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD">repository</a> exists, which already houses two example BCF files in
<tt class="docutils literal">examples/</tt>,
supplied by <a class="reference external" href="https://forum.freecadweb.org/memberlist.php?mode=viewprofile&amp;u=68">yorik</a>. This repository is intended to be the main development repository.
I started a little UML class diagram, which you can find in
the folder <tt class="docutils literal">doc/</tt> in the root directory of the repository.</p>
<p>Note however, the class "Template" is just used for copy and paste. I used it to
set the font to Sourcecode Pro, which was kind of tedious, and since I didn't
know if these font changes translate to newly created classes too I have gone
with the copy&amp;paste approach. The classes presented in this diagram are all for
representing the data from the markup.bcf file (except for the class "Project").
For the creation of these class diagrams I use <a class="reference external" href="http://dia-installer.de/download/linux.html.de">Dia</a>.</p>
<p>The current problem I am facing is: how to represent the constraints given in
the <tt class="docutils literal">extension.xsd</tt> file (a link to it <a class="reference external" href="https://github.com/buildingSMART/BCF-XML/tree/master/Extension%20Schemas">here</a>). The most constraints listed in
this file are just listings of valid values for some nodes or attributes. What I
want to do is to force the user of this classes to use one of the valid values
and not have to implement extra code that checks each time the value is set or
written to a file for that matter.</p>
<p><strong>So what possibilities do I have to choose from?</strong></p>
<p>Probably most intuitively would be to create one enumeration class (<a class="reference external" href="https://docs.python.org/3/library/enum.html">python
reference</a>) for each attibute or node listed in <tt class="docutils literal">extensions.xsd</tt>. The main
disadvantage her ist that these enumerations have to be maintained by hand, in
the case of a change to <tt class="docutils literal">extensions.xsd</tt>. That makes this first intuitive
option quite unattractive.</p>
<p>The second option that comes to mind would be to parse <tt class="docutils literal">extensions.xsd</tt> and
then programmatically define the enumerations. This is possible due to the
dynamically typed nature of python. However this also implies that the classes,
containing a representation of an affected attribute or node, also have to be
modified every time the plugin starts and <tt class="docutils literal">extensions.xsd</tt> is parsed. This is
because the classes, of which type the class variables are, do not exist before
runtime.</p>
<p>A third approach would also be possible where one enumeration class is written,
before runtime, with no values. Then during startup <tt class="docutils literal">extensions.xsd</tt> gets
parsed and the valid values are added to the enumerations. That however has one
drawback: if the standard gets updated, and a new constraint is put upon another
field then an according class would have to be created manually.</p>
<p>In the end I still have to think about how it is done best, and what is the most
maintainable version. Already I tend to latter option, because when the standard
changes, most probably also the implementation of this plugin has to change.</p>
</div>
    </div>
    </article><article class="blog-post h-entry post-text"><header><h2 class="p-name entry-title blog-post-title"><a href="posts/references-to-read/" class="u-url">BCF Reference Collection - GSoC 2019 </a></h2>
        <div class="metadata blog-post-meta">
            <p class="byline author vcard"><span class="byline-name fn">Patrick Podest</span></p>
            <p class="dateline"><a href="posts/references-to-read/" rel="bookmark"><time class="published dt-published" datetime="2019-05-11T08:08:01+00:00" title="2019-05-11 08:08">2019-05-11 08:08</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Following is a list of all references that were mentioned in the forum. I split
them into two categories (for now): Documentation, Implementation Reference. In
former category standards and definitions are to be found (e.g.: BCF-XML
Documentation). The category "Implementation Reference" shall hold links to
examples, tutorials etc.</p>
<p>This list of references is most likely to grow over time.</p>
<div class="section" id="diskussion">
<h2>Diskussion</h2>
<ol class="arabic simple">
<li><a class="reference external" href="https://forum.freecadweb.org/viewtopic.php?style=4&amp;f=23&amp;t=22641&amp;start=10">Forum topic on BCF</a></li>
</ol>
</div>
<div class="section" id="documentation">
<h2>Documentation</h2>
<ol class="arabic simple">
<li><a class="reference external" href="https://www.linkedin.com/pulse/how-get-most-out-open-bim-alejandro-mata/">How to Get Most out of OpenBim</a></li>
<li><a class="reference external" href="https://github.com/BuildingSMART/BCF-XML/tree/master/Documentation">BCF-XML Documentation</a></li>
<li>
<a class="reference external" href="https://forum.freecadweb.org/viewtopic.php?f=18&amp;t=12833">FEM Python coding standard</a>: coding guidlines that I want to adhere to
during development (written by PrzemoF).</li>
</ol>
</div>
<div class="section" id="implementation-reference">
<h2>Implementation Reference</h2>
<ol class="arabic simple">
<li>
<a class="reference external" href="https://github.com/opensourceBIM/BIMbots-FreeCAD">BIMBots-FreeCAD</a>: standalone plugin created by Yorik, serves as example on
plugin programming in FreeCAD</li>
<li><a class="reference external" href="https://doc.qt.io/qt-5/qtdesigner-manual.html">QTDesigner Tutorial</a></li>
<li>
<a class="reference external" href="https://github.com/teocomi">Matteo Cominetti</a>: Author of the GNU BCFier plugin. May be a useful contact
on questions regarding BCF definition.</li>
<li>
<a class="reference external" href="https://github.com/opensourceBIM/BCF-Forum">BCF Server and Forum</a>: "[...] Wordpress plugin to create a 'BCF topic
server' from your wordpress installation [...]"</li>
</ol>
</div>
</div>
    </div>
    </article>
</div>







            </div>
            <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
                <div class="sidebar-module sidebar-module-inset">
  <h4>About</h4>
  <p>This is the development blog for the BCF-Plugin for FreeCAD. This project
  is mentored by @yorik and @hardeeprai and done by @podestplatz. Its purpose
  is to integrate support for BCF into the BIM workbench of FreeCAD.</p>
</div>
<div class="sidebar-module">
  <h4>Links</h4>
  <ol class="list-unstyled">
<li><a href="https://github.com/podestplatz/BCF-Plugin-FreeCAD">BCF-Plugin on github</a></li>
    <li><a href="https://freecadweb.org">FreeCAD</a></li>
    <li><a href="https://forum.freecadweb.org/viewtopic.php?f=8&amp;t=35465">Plugin Forum Thread</a></li>
    <li><a href="https://github.com/podestplatz">@podestplatz</a></li>
  </ol>
</div>

            </div>
        <!--End of body content-->
        </div>
    </div>
</div>

<footer class="blog-footer" id="footer">
    Contents  2019         <a href="mailto:podestplatz@gmail.com">Patrick Podest</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
    
</footer><script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
