<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>BCF-Plugin GSoC 2019 | FreeCAD BCF-Plugin development blog</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://podestplatz.github.io/FreeCAD-blog/posts/bcf-plugin-gsoc-2019/">
<link rel="icon" href="../../favicon-16.ico" sizes="16x16">
<link rel="icon" href="../../favicon-32.ico" sizes="32x32">
<link rel="icon" href="../../favicon-256.ico" sizes="256x256">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Patrick Podest">
<link rel="prev" href="../writing-non-schema-conform-bcf-files/" title="Writing non Schema Conform BCF Files" type="text/html">
<link rel="next" href="../dev-logs/" title="Dev Logs" type="text/html">
<meta property="og:site_name" content="FreeCAD BCF-Plugin development blog">
<meta property="og:title" content="BCF-Plugin GSoC 2019">
<meta property="og:url" content="https://podestplatz.github.io/FreeCAD-blog/posts/bcf-plugin-gsoc-2019/">
<meta property="og:description" content="This blog post shall give detailed information about the project
GSoC 2019 BCF-Plugin. The following sections will elaborate on a few key
aspects of the project including:

the initial vision and with">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-08-03T10:09:52Z">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<div class="blog-masthead">
    <div class="container">
<!-- This keeps the margins nice -->
        <nav class="blog-nav" role="navigation"><a href="../../index.html" class="blog-nav-item">Home</a>
            <a href="../../archive.html" class="blog-nav-item">Archive</a>
            <a href="../../categories/index.html" class="blog-nav-item">Tags</a>
            <a href="../../rss.xml" class="blog-nav-item">RSS feed</a>

            

                
                
                    
    <a href="index.rst" class="blog-nav-item blog-nav-item-aside" id="sourcelink">Source</a>

                
            
        </nav>
</div>
<!-- /.container -->
</div>
<!-- End of Menubar -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <div class="blog-header">
            <h1 class="blog-title">
                <a href="https://podestplatz.github.io/FreeCAD-blog/">

                    <span id="blog-title">FreeCAD BCF-Plugin development blog</span>
                </a>
            </h1>
            <p class="lead blog-description">Blog to the development of the BCF FreeCAD plugin.</p>
            
        </div>
        <!--Body content-->
        <div class="row">
            <div class="col-sm-8 blog-main">
                
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h2 class="p-name entry-title blog-post-title" itemprop="headline name"><a href="." class="u-url">BCF-Plugin GSoC 2019</a></h2>

        <div class="metadata blog-post-meta">
            <p class="byline author vcard"><span class="byline-name fn">Patrick Podest</span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="published dt-published" datetime="2019-08-03T10:09:52+00:00" itemprop="datePublished" title="2019-08-03 10:09">2019-08-03 10:09</time></a></p>
            
        <p class="sourceline"><a href="index.rst" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>This blog post shall give detailed information about the project
<a class="reference external" href="https://summerofcode.withgoogle.com/#Link">GSoC 2019 BCF-Plugin</a>. The following sections will elaborate on a few key
aspects of the project including:</p>
<ul class="simple">
<li>the initial vision and with it the reason why it was done</li>
<li>some information about the BCF standard</li>
<li>what exactly has been accomplished in this project</li>
<li>main hurdles that cost a considerable amout of time</li>
<li>ideas for improvment.</li>
</ul>
<div class="section" id="vision">
<h2>Vision</h2>
<p>BCF stands for BIM (Building Information Modelling) Collaboration Format. It is
used in the industry by architects to collaborate effectively on one building
model. Collaboration in BCF terms means that, apart from the building model a
separate BCF file is handed over to the other architect(s). Using a tool that
supports the standard, these parties can then add issues/topics, supply these
with context in from of comments, snapshots, addtional documents and more.</p>
<p>The intent behind the <a class="reference external" href="https://github.com/podestplat/BCF-Plugin-FreeCAD">FreeCAD BCF-Plugin</a> was to also integrate support for
BCF into FreeCAD, and thus adding FreeCAD to the list of <a class="reference external" href="https://www.bimcollab.com/en/BCF-Manager/BCF-Manager">BCF supporting CAD
tools</a>.</p>
</div>
<div class="section" id="bcf-standard">
<h2>BCF-Standard</h2>
<p>During the course of the project I have written quite a lot of documentation.
This includes already a primer on the BCF standard that is more expansive than
the one above. So for more information on BCF please refer to the project's <a class="reference external" href="https://github.com/podestplatz/BCF-Plugin-FreeCAD/wiki/Home">wiki
page</a>.</p>
</div>
<div class="section" id="outcome">
<h2>Outcome</h2>
<p>FreeCAD can be used in two modes:</p>
<ol class="arabic simple">
<li>GUI-mode: in this mode FreeCAD can be used as Qt application.</li>
<li>nonGUI-mode: is composed of a python console that gives access to all aspects
of the opened file.</li>
</ol>
<p>Apart from these two modes, a plugin framework was implemented which is able to
run standalone python applications within the FreeCAD context. Through the
suggestions of my mentors (@yorik and @hardeeprai) I developed the BCF
integration as python application that accesses FreeCAD's state via the its
python interface.
The plugin, like its host application, can be controlled either via a graphical
user interface or via the python console, proviced also by FreeCAD.</p>
<hr class="docutils">
<p>Complete integration of the BCF standard in the timeframe of just about three
months would have required more than one person, presumably. Thus, here the
aspects that are accessible through the GUI are listed (practically everything
can be done in nonGUI-mode, since complete access to the parsed BCF file is
given to the user):</p>
<ul class="simple">
<li>BCF files are read into an internal data model</li>
<li>a topic can be chosen from the list of specified ones.</li>
<li>most metrics of a topic can be edited in a separate window.</li>
<li>the list of additional document references of a topic can be displayed</li>
<li>relations between topics can be explored</li>
<li>comments can be edited/added/removed (this is the part which was most
emphasized during development)</li>
<li>the snapshots of a topic are shown,</li>
<li>as well as a list of all available viewpoints.</li>
<li>a snapshot can be opened in full resolution</li>
<li>a viewpoint can be applied to the object viewer of FreeCAD.</li>
<li>the current state of the bcf file can also be saved to file again.</li>
</ul>
</div>
<div class="section" id="hurdles-along-the-way">
<h2>Hurdles along the way</h2>
<p>In this section I want to list some of the most significant hurdles I
experienced during the last three months.</p>
<p>The biggest of all probably was supporting BCF files that do not comply with the
standard. Unfortunately it is intended by the BIM collaboration that vendors of
BCF tools can add their flavor to the BCF files created by their tools. This posed
quite the obstacle in two ways:</p>
<ol class="arabic simple">
<li>What to do with additional and malformed information, that is not defined by
the standard?</li>
<li>How can BCF files be opened and written again without losing potential
information that did not comply to the standard?</li>
</ol>
<p>The approach taken for (1) was to just omit data that did not comply to the
standard during reading it in. However, this had significant consequences for
(2) as it ruled out the easiest strategy for writing a BCF file: just
serializing the whole data model from memory to disk. Thus, (2) was solved by using an
update write strategy. Thereby the BCF file is opened in a temporary directory,
and every modification, done by the user will be commited to it as an update.
This update approach was designed to also support batch processing (i.e.: write
multiple updates at once instead of immediatly when they arise).</p>
<hr class="docutils">
<p>The second major hurdle was the comment list in Qt. My background in programming
does not include user interface programming and thus I had no experience with
Qt. Items in the comment list show the three major aspects of a comment at once:</p>
<ul class="simple">
<li>the comment text itself</li>
<li>the E-Mail address of the person that either created or, if the comment already was
modified, modified it at last, and</li>
<li>the date of creation or last modification respectively.</li>
</ul>
<p>These three aspects are split up into two rows, separated by a thin line, where
the comment fills the first row and comment and date share the second row.
The difficulty here was to properly implement custom list elements in the
<a class="reference external" href="https://doc.qt.io/qt-5/model-view-programming.html">Model/View Paradigm</a> of Qt. The current implementation uses, apart from a
custom model and view, a delegate. It is responsible for drawing the list
elements as described above and for handling modifications to the list elements.</p>
<hr class="docutils">
<p>The last, in comparison, rather small hurdle was the correct handling of
temporary directories. In theory it is quite easy:</p>
<ol class="arabic simple">
<li>a <cite>TemporaryDirectory</cite> object is created like in the code example below.
This object is itself a context manager and automatically deletes the
temporary directory again when it is garbage collected.</li>
</ol>
<blockquote>
<pre class="code python"><a name="rest_code_8336a31726324dfb8079d4c6f4199fa4-1"></a><span class="kn">import</span> <span class="nn">tempfile</span>
<a name="rest_code_8336a31726324dfb8079d4c6f4199fa4-2"></a><span class="n">tmpDir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span>
</pre>
</blockquote>
<ol class="arabic simple" start="2">
<li>when you are finished run <cite>del tmpDir</cite> and the whole directory will be
deleted again.</li>
<li>during runtime of the application store the object in the application global
space.</li>
</ol>
<p>That is the theory. However in combination with Qt's event handling mechanism
the assumption that the application global variable will have the same state
when reading it in an event handler and in normal operation does not hold
anymore.</p>
<p>In my case I had a global function <cite>getSystemTmp()</cite> that creates a temporary
directory only on first invocation, and on each subsequent call return the
already created directorie's path. However, it twice created a new temporary
directory. The second one was created when asking the user for his/her E-Mail
address before a change is commited.</p>
<p>In the end this context problem was solved by a separate file in the system's
temporary directory. It holds only the path to the created temporary directory,
which serves as working directory. Thus, now <cite>getSystemTmp()</cite> creates the file
on the first invocation and on each subsequent call reads the one line from the
file and returns it.</p>
</div>
<div class="section" id="outlook">
<h2>Outlook</h2>
<p>Some things are still missing at this point in time (2019-08-19)
Following a list of things that the plugin still needs to serve the
user best.</p>
<ul class="simple">
<li>Apart from opening and saving an already existing BCF file, the creation of a
completely new one is probably integral to a BCF tool.</li>
<li>Adding new topics to a project</li>
<li>Link comments to viewpoints</li>
<li>Add new viewpoints</li>
<li>Create snapshots</li>
<li>A list showing referenced documents with their respective paths is already
implemented, but it would be nice if they also could be opened right from the
plugin with a double left click or something like that.</li>
<li>Create relations between topics in form of <cite>&lt;RelatedTopic&gt;</cite> nodes in the
<cite>markup.bcf</cite> file.</li>
</ul>
<hr class="docutils">
<p>At this point I want to thank my mentors Yorik van Havre and Hardeeprai
(unfortunatel I don't know if his real name is written this way, because I only
knew him by his user name on the freecad forum), for giving me the possibility
to contribute to FreeCAD in a meaningful manner!</p>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../writing-non-schema-conform-bcf-files/" rel="prev" title="Writing non Schema Conform BCF Files">Previous post</a>
            </li>
            <li class="next">
                <a href="../dev-logs/" rel="next" title="Dev Logs">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
            <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
                <div class="sidebar-module sidebar-module-inset">
  <h4>About</h4>
  <p>This is the development blog for the BCF-Plugin for FreeCAD. This project
  is mentored by @yorik and @hardeeprai and done by @podestplatz. Its purpose
  is to integrate support for BCF into the BIM workbench of FreeCAD.</p>
</div>
<div class="sidebar-module">
  <h4>Links</h4>
  <ol class="list-unstyled">
<li><a href="https://github.com/podestplatz/BCF-Plugin-FreeCAD">BCF-Plugin on github</a></li>
    <li><a href="https://freecadweb.org">FreeCAD</a></li>
    <li><a href="https://forum.freecadweb.org/viewtopic.php?f=8&amp;t=35465">Plugin Forum Thread</a></li>
    <li><a href="https://github.com/podestplatz">@podestplatz</a></li>
  </ol>
</div>

            </div>
        <!--End of body content-->
        </div>
    </div>
</div>

<footer class="blog-footer" id="footer">
    Contents © 2019         <a href="mailto:podestplatz@gmail.com">Patrick Podest</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
    
</footer><script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
